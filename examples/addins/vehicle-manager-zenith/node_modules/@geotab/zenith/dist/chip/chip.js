"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Chip = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const useDrive_1 = require("../utils/theme/useDrive");
const useDriveClassName_1 = require("../utils/theme/useDriveClassName");
const classNames_1 = require("../commonHelpers/classNames/classNames");
const getChipStateClassName_1 = require("./utils/getChipStateClassName");
const iconClose_1 = require("../icons/iconClose");
const useLanguage_1 = require("../utils/localization/useLanguage");
const useChip_1 = require("./utils/useChip");
function isChipTrigger(props) {
    return "triggerRef" in props;
}
const Chip = (props) => {
    const { className, children, disabled, icon, id, status, quantity, onClose, title } = props;
    const isTriggerMode = isChipTrigger(props);
    const readonly = !isTriggerMode ? props.readonly : undefined;
    const onChange = !isTriggerMode ? props.onChange : undefined;
    const active = !isTriggerMode ? props.active : false;
    const triggerRef = isTriggerMode ? props.triggerRef : undefined;
    const closeAriaText = isTriggerMode ? props.closeAriaText : undefined;
    const isOpen = isTriggerMode ? props.isOpen : false;
    const onClick = isTriggerMode ? props.onClick : undefined;
    const hasQuantity = typeof quantity === "number";
    const chipId = (0, react_1.useId)();
    const isDrive = (0, useDrive_1.useDrive)();
    const { translate } = (0, useLanguage_1.useLanguage)();
    const driveTextClass = (0, useDriveClassName_1.useDriveClassName)("zen-chip-text-content");
    const driveChipClass = (0, useDriveClassName_1.useDriveClassName)("zen-chip");
    const hasIcon = !!icon;
    const isClosable = !!onClose;
    const hasContent = !!children;
    const { ref, title: chipTitle } = (0, useChip_1.useChip)(title, isTriggerMode ? { triggerRef: triggerRef, children } : undefined);
    const svgIcon = (0, react_1.useMemo)(() => hasIcon ? (0, react_1.createElement)(icon, {
        className: "zen-chip__icon",
        size: isDrive ? "huger" : "large"
    }) : null, [hasIcon, icon, isDrive]);
    const onChangeHandler = (0, react_1.useCallback)((e) => {
        if (readonly || !onChange) {
            return;
        }
        onChange(e.target.checked);
    }, [onChange, readonly]);
    const handleClick = (0, react_1.useCallback)(() => {
        if (onClick) {
            onClick(!isOpen);
        }
    }, [onClick, isOpen]);
    const onKeyDownHandler = (0, react_1.useCallback)((e) => {
        if (e.key === "Enter" && !disabled && !readonly && onChange) {
            onChange(!active);
            return;
        }
        if (e.key === " " && !disabled && !readonly && onChange) {
            e.preventDefault();
            onChange(!active);
        }
    }, [disabled, readonly, active, onChange]);
    const chipTriggerKeyDownHandler = (0, react_1.useCallback)((e) => {
        var _a;
        if ((_a = document.activeElement) === null || _a === void 0 ? void 0 : _a.classList.contains("zen-chip__close-button")) {
            return;
        }
        if (e.key === "Enter" && !disabled && !readonly) {
            e.preventDefault();
            handleClick();
            return;
        }
        if (e.key === " " && !disabled && !readonly) {
            handleClick();
        }
    }, [disabled, readonly, handleClick]);
    const onKeyUpHandler = (0, react_1.useCallback)((e) => {
        var _a;
        if (e.key === "Tab" || e.key === "Enter" || e.key === " ") {
            (_a = ref.current) === null || _a === void 0 ? void 0 : _a.classList.add("zen-chip--keyboard-nav");
        }
    }, [ref]);
    const onBlurHandler = (0, react_1.useCallback)(() => {
        var _a;
        (_a = ref.current) === null || _a === void 0 ? void 0 : _a.classList.remove("zen-chip--keyboard-nav");
    }, [ref]);
    const handleClose = (0, react_1.useCallback)((e) => {
        e.stopPropagation();
        e.preventDefault();
        isClosable && onClose(id || chipId);
    }, [isClosable, onClose, id, chipId]);
    const memoizedClasses = (0, react_1.useMemo)(() => [
        "zen-chip",
        driveChipClass !== null && driveChipClass !== void 0 ? driveChipClass : "",
        isTriggerMode ? (0, getChipStateClassName_1.getChipTriggerStateClassName)(!!disabled, isOpen, status) : (0, getChipStateClassName_1.getChipStateClassName)(!!disabled, !!readonly, active, status),
        className !== null && className !== void 0 ? className : ""
    ], [driveChipClass, isTriggerMode, disabled, isOpen, status, readonly, active, className]);
    const chipComponent = (0, react_1.useMemo)(() => (0, jsx_runtime_1.jsxs)("label", { className: (0, classNames_1.classNames)(memoizedClasses), ref: ref, title: chipTitle, htmlFor: id || chipId, children: [(0, jsx_runtime_1.jsx)("input", { checked: active, onBlur: onBlurHandler, onKeyUp: onKeyUpHandler, onKeyDown: onKeyDownHandler, onChange: onChangeHandler, id: id || chipId, className: "zen-chip__input", type: "checkbox", disabled: disabled, readOnly: readonly }), children ? (0, jsx_runtime_1.jsx)("div", { className: (0, classNames_1.classNames)(["zen-chip-text-content", driveTextClass !== null && driveTextClass !== void 0 ? driveTextClass : ""]), children: children }) : null, svgIcon, isClosable && (0, jsx_runtime_1.jsx)("button", { type: "button", className: "zen-chip__close-button", onClick: handleClose, title: closeAriaText || translate("Close"), "aria-label": closeAriaText || translate("Close"), children: (0, jsx_runtime_1.jsx)(iconClose_1.IconClose, { size: isDrive ? "huger" : "large", className: "zen-pill-non-actionable__close-icon" }) })] }), [memoizedClasses, ref, chipTitle, id, chipId, active, onBlurHandler, onKeyUpHandler, onKeyDownHandler, onChangeHandler, disabled, readonly, children, driveTextClass, svgIcon, isClosable,
        handleClose, closeAriaText, translate, isDrive]);
    const chipTriggerComponent = (0, react_1.useMemo)(() => {
        const extraAttributes = chipTitle ? { "aria-label": chipTitle } : {};
        return (0, jsx_runtime_1.jsx)("div", Object.assign({ role: "button", tabIndex: 0 }, extraAttributes, { onClick: handleClick, onKeyDown: chipTriggerKeyDownHandler, className: (0, classNames_1.classNames)(memoizedClasses), "data-id": id || chipId, ref: triggerRef, children: (0, jsx_runtime_1.jsxs)("div", { className: "zen-chip__content-wrapper", children: [hasContent ? (0, jsx_runtime_1.jsx)("div", { className: (0, classNames_1.classNames)(["zen-chip-text-content", driveTextClass !== null && driveTextClass !== void 0 ? driveTextClass : ""]), children: children }) : null, svgIcon, isClosable && (0, jsx_runtime_1.jsx)("button", { type: "button", className: "zen-chip__close-button", onClick: handleClose, title: closeAriaText || translate("Close"), "aria-label": closeAriaText || translate("Close"), children: (0, jsx_runtime_1.jsx)(iconClose_1.IconClose, { size: isDrive ? "huger" : "large", className: "zen-pill-non-actionable__close-icon" }) }), hasQuantity && quantity ? (0, jsx_runtime_1.jsx)("div", { className: "zen-chip__quantity", children: quantity }) : null] }) }));
    }, [handleClick, chipTriggerKeyDownHandler, memoizedClasses, id, chipId, triggerRef, hasContent, chipTitle, driveTextClass, children, svgIcon, isClosable, handleClose,
        closeAriaText, translate, isDrive, hasQuantity, quantity]);
    return isTriggerMode ? chipTriggerComponent : chipComponent;
};
exports.Chip = Chip;
