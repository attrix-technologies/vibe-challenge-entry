"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TRANSLATIONS = exports.StepperRaw = exports.INPUT_DEFAULT_WIDTH_DRIVE = exports.INPUT_DEFAULT_WIDTH = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const classNames_1 = require("../commonHelpers/classNames/classNames");
const iconChevronDownSmall_1 = require("../icons/iconChevronDownSmall");
const textIconButton_1 = require("../textIconButton/textIconButton");
const iconChevronTopSmall_1 = require("../icons/iconChevronTopSmall");
const buttonType_1 = require("../button/buttonType");
const getDecreasedValue_1 = require("./utils/getDecreasedValue");
const getIncreasedValue_1 = require("./utils/getIncreasedValue");
const getValidStep_1 = require("./utils/getValidStep");
const getValidValue_1 = require("./utils/getValidValue");
const getValidInputWidth_1 = require("./utils/getValidInputWidth");
const useLanguage_1 = require("../utils/localization/useLanguage");
const useDriveClassName_1 = require("../utils/theme/useDriveClassName");
const useDrive_1 = require("../utils/theme/useDrive");
const onBeforeInput_1 = require("./utils/onBeforeInput");
// according to design
exports.INPUT_DEFAULT_WIDTH = 47;
exports.INPUT_DEFAULT_WIDTH_DRIVE = 56;
exports.StepperRaw = (0, react_1.forwardRef)(
// eslint-disable-next-line @typescript-eslint/naming-convention
function InnerStepper({ min = -Infinity, max = +Infinity, step = 1, width, disabled = false, readonly = false, value = "", isError, onChange, placeholder = "", className = "", maxLength, id, ariaLabel }, ref) {
    const driveComponentClass = (0, useDriveClassName_1.useDriveClassName)("zen-stepper-field");
    const driveInputClass = (0, useDriveClassName_1.useDriveClassName)("zen-text-input");
    const isDrive = (0, useDrive_1.useDrive)();
    const isErrorShown = !disabled && !readonly && isError;
    const validStep = (0, getValidStep_1.getValidStep)(step);
    const validValue = (0, getValidValue_1.getValidValue)(value, min, max);
    const inputWidth = (0, getValidInputWidth_1.getValidInputWidth)(width || (isDrive ? exports.INPUT_DEFAULT_WIDTH_DRIVE : exports.INPUT_DEFAULT_WIDTH), isDrive);
    const handleChange = (0, react_1.useCallback)((e) => {
        // prevent cases, when user types "-" in the middle of the number, e.g "1-2"
        if (!e.target.value && e.nativeEvent.data === "-") {
            return;
        }
        if (!e.target.value) {
            onChange("");
            return;
        }
        const newValue = (0, getValidValue_1.getValidValue)(e.target.value, min, max);
        newValue.toString() !== value.toString() && onChange(newValue.toString());
    }, [max, min, onChange, value]);
    const { translate } = (0, useLanguage_1.useLanguage)();
    const localRef = (0, react_1.useRef)(null);
    const currRef = (ref || localRef);
    return (0, jsx_runtime_1.jsx)("div", { className: (0, classNames_1.classNames)(["zen-stepper-field", driveComponentClass || "", disabled ? "zen-stepper-field--disabled" : "", className]), children: (0, jsx_runtime_1.jsxs)("div", { className: "zen-stepper-field__input-wrapper", children: [(0, jsx_runtime_1.jsx)("input", { id: id, ref: currRef, min: min, max: max, value: validValue, onBeforeInput: onBeforeInput_1.onBeforeInput, onChange: handleChange, disabled: disabled, type: "number", step: step, className: (0, classNames_1.classNames)(["zen-stepper-field__input", "zen-text-input", driveInputClass || "", isErrorShown ? "zen-stepper-field__input--error" : ""]), style: { width: `${inputWidth}px` }, placeholder: placeholder, readOnly: readonly, maxLength: maxLength, "aria-label": ariaLabel }), !readonly && (0, jsx_runtime_1.jsxs)("div", { className: "zen-stepper-field__controls", style: { left: `${inputWidth - 24}px` }, children: [(0, jsx_runtime_1.jsx)(textIconButton_1.TextIconButton, { icon: iconChevronTopSmall_1.IconChevronTopSmall, type: buttonType_1.ButtonType.TertiaryBlack, iconPosition: textIconButton_1.ButtonIconPosition.Start, iconSize: isDrive ? "huge" : "large", className: "zen-stepper-field__control", tabIndex: -1, onClick: () => {
                                var _a;
                                onChange(String((0, getIncreasedValue_1.getIncreasedValue)(validValue, validStep, max)));
                                (_a = currRef.current) === null || _a === void 0 ? void 0 : _a.focus();
                            }, "aria-label": translate("Increase value") }), (0, jsx_runtime_1.jsx)(textIconButton_1.TextIconButton, { icon: iconChevronDownSmall_1.IconChevronDownSmall, type: buttonType_1.ButtonType.TertiaryBlack, iconPosition: textIconButton_1.ButtonIconPosition.Start, iconSize: isDrive ? "huge" : "large", className: "zen-stepper-field__control", tabIndex: -1, onClick: () => {
                                var _a;
                                onChange(String((0, getDecreasedValue_1.getDecreasedValue)(validValue, validStep, min)));
                                (_a = currRef.current) === null || _a === void 0 ? void 0 : _a.focus();
                            }, "aria-label": translate("Decrease value") })] })] }) });
});
exports.TRANSLATIONS = [
    "Decrease value",
    "Increase value"
];
