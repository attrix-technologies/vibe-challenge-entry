"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Alert = void 0;
const react_1 = require("react");
const feedbackContext_1 = require("../feedbackContainer/feedbackContext");
const useWarning_1 = require("../feedbackProvider/hooks/useWarning");
const Alert = ({ isOpen, text, header, type, onClose, buttons, id }) => {
    const { addAlert, removeAlert, alertsQueue, alerts, alertsAnimation, removedAlertId, mode, apiAlertActions } = (0, react_1.useContext)(feedbackContext_1.FeedbackContext);
    const generatedId = (0, react_1.useId)();
    const localId = id || generatedId;
    const isInQueue = alertsQueue.some((alert) => alert.id === localId);
    const isRendered = alerts.some((alert) => alert.id === localId);
    const isAnimating = alertsAnimation.some((alert) => alert.id === localId);
    const isInApiAlerts = !!apiAlertActions.find((alert) => alert.id === localId);
    const isAPI = mode === "api";
    const alertIndex = alerts.findIndex((alert) => alert.id === localId);
    (0, useWarning_1.useWarning)({ mode, name: "alerts" });
    (0, react_1.useEffect)(() => {
        if (isAPI) {
            if (isOpen && !isInApiAlerts) {
                addAlert({ header, text, id: localId, type, onClose: () => {
                        onClose();
                    }, buttons });
                return;
            }
            if (!isOpen && isInApiAlerts) {
                removeAlert(localId);
                onClose();
            }
            return;
        }
        if (isOpen && isInQueue && isRendered) {
            return;
        }
        if (isOpen && (!isInQueue && !isRendered)) {
            addAlert({ header, text, id: localId, type, onClose: () => {
                    onClose();
                }, buttons });
            return;
        }
        if (!isOpen && isRendered && !isInQueue && !isAnimating) {
            if (alertIndex !== -1) {
                removedAlertId.current = alertIndex;
            }
            removeAlert(localId);
            onClose();
        }
    }, [localId, isOpen, text, header, type, addAlert, onClose, removeAlert, isInQueue, isRendered, isAnimating, alertIndex, removedAlertId, buttons, isAPI, isInApiAlerts]);
    return null;
};
exports.Alert = Alert;
