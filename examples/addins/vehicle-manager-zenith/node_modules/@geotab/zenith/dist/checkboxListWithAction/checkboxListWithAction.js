"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TRANSLATIONS = exports.CheckboxListWithAction = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const checkbox_1 = require("../checkbox/checkbox");
const classNames_1 = require("../commonHelpers/classNames/classNames");
const iconChevronRight_1 = require("../icons/iconChevronRight");
const useLanguage_1 = require("../utils/localization/useLanguage");
const useDriveClassName_1 = require("../utils/theme/useDriveClassName");
const CheckboxListWithAction = ({ label, options, onChange, onClick, search = [], className }) => {
    const { translate } = (0, useLanguage_1.useLanguage)();
    const driveComponentClass = (0, useDriveClassName_1.useDriveClassName)("zen-checkbox-list-with-action");
    const listId = (0, react_1.useId)();
    const checkboxId = `${listId}_check_list-item_`;
    const handleChange = (e) => {
        const evtTarget = e.target;
        const elId = evtTarget.getAttribute("id").replace(checkboxId, "");
        onChange({ id: elId, state: evtTarget.checked, partial: e.target.dataset.indeterminate === "true" });
    };
    const handleClick = (e) => {
        var _a;
        const evtTarget = e.target;
        const elId = evtTarget.getAttribute("data-btn") || ((_a = evtTarget.parentElement) === null || _a === void 0 ? void 0 : _a.getAttribute("data-btn")) || "";
        onClick(elId);
    };
    const getLabelColorInfo = (color, withRightPadding, isHidden, extraArgs) => {
        if (!color) {
            return null;
        }
        const colorAlpha = Math.round(color.a * 100 / 255) / 100;
        const opacityValue = colorAlpha < 0.1 ? 0.1 : colorAlpha;
        const colorString = `rgba(${color.r},${color.g},${color.b},${opacityValue})`;
        return (0, jsx_runtime_1.jsx)("div", Object.assign({}, extraArgs, { className: (0, classNames_1.classNames)(["zen-checkbox-list-with-action__color-info", withRightPadding ? "zen-checkbox-list-with-action__color-info--right-indent" : "",
                isHidden ? "zen-checkbox-list-with-action__color-info--hidden" : ""]), style: { backgroundColor: colorString } }));
    };
    const getLabelCountSelectedChild = (countSelectedChild, extraArgs) => {
        if (!countSelectedChild) {
            return null;
        }
        return (0, jsx_runtime_1.jsx)("div", Object.assign({}, extraArgs, { "aria-hidden": "true", className: "zen-checkbox-list-with-action__label-count", children: (0, jsx_runtime_1.jsx)("div", { className: "zen-checkbox-list-with-action__counter", children: (0, jsx_runtime_1.jsx)("span", { children: countSelectedChild }) }) }));
    };
    const renderLabel = (option, lbl, ttl) => {
        const additionalTitle = option.countSelectedChild && option.isWithAction ?
            translate("Number of selected child groups - {count}").replace("{count}", option.countSelectedChild.toString()) : "";
        const title = option.isWithAction ? translate("View {groupName} children").replace("{groupName}", ttl).concat(additionalTitle ? `${". "}${additionalTitle}` : "")
            : translate("Toggle {groupName} filter").replace("{groupName}", ttl);
        const classN = (0, classNames_1.classNames)(["zen-checkbox-list-with-action__label", "zen-ellipsis",
            option.isWithAction ? "zen-checkbox-list-with-action__label--action" : ""]);
        const otherArgs = option.isWithAction ? { "data-btn": option.property } : {};
        const childEl = (0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsxs)("div", Object.assign({ className: "zen-checkbox-list-with-action__label-text zen-ellipsis" }, otherArgs, { children: [(0, jsx_runtime_1.jsx)("span", Object.assign({ className: "zen-ellipsis" }, otherArgs, { children: lbl })), getLabelCountSelectedChild(option.countSelectedChild, otherArgs)] })), (0, jsx_runtime_1.jsxs)("div", Object.assign({ className: "zen-checkbox-list-with-action__label-info" }, otherArgs, { children: [getLabelColorInfo(option.color, option.isWithAction, option.partialChecked, otherArgs), option.isWithAction && (0, jsx_runtime_1.jsx)(iconChevronRight_1.IconChevronRight, { size: "large" })] }))] });
        return option.isWithAction ? (0, jsx_runtime_1.jsx)("button", Object.assign({ type: "button", onClick: handleClick, title: title, className: classN }, otherArgs, { children: childEl })) : (0, jsx_runtime_1.jsx)("div", { className: classN, title: title, children: childEl });
    };
    const build = (optionsArr) => {
        const selectSearchTerm = (wholeString) => {
            if (!search.length) {
                return wholeString;
            }
            let selectedString = wholeString;
            search.forEach(searchPart => {
                const strArr = selectedString.split(searchPart);
                selectedString = strArr.map((str, ind) => (0, jsx_runtime_1.jsxs)(react_1.Fragment, { children: [ind ? (0, jsx_runtime_1.jsx)("span", { className: "zen-checkbox-list-with-action__singled", children: searchPart }, `searchTerm_${ind}_search`) : null, (0, jsx_runtime_1.jsx)("span", { children: str }, `searchTerm_${ind}`)] }, ind));
            });
            return selectedString;
        };
        return optionsArr ? (0, jsx_runtime_1.jsx)("ul", { className: "zen-checkbox-list-with-action__list", children: optionsArr.map((opt, ind) => {
                const titleForRender = opt.title || opt.label;
                const labelForRender = selectSearchTerm(opt.label);
                const labelElement = renderLabel(opt, labelForRender, titleForRender);
                return (0, jsx_runtime_1.jsxs)("li", { className: (0, classNames_1.classNames)(["zen-checkbox-list-with-action__action-item", opt.isWithAction ? "zen-checkbox-list-with-action__action-item--action" : ""]), "data-item": opt.property, children: [(0, jsx_runtime_1.jsx)(checkbox_1.Checkbox, { id: `${checkboxId}${opt.property}`, onChange: handleChange, className: (0, classNames_1.classNames)(["zen-checkbox-list-with-action__list-item zen-checkbox-list-with-action__action-checkbox",
                                opt.isWithAction ? "" : "zen-checkbox-list-with-action__action-checkbox--full-width"]), indeterminate: opt.partialChecked, checked: opt.checked, disabled: opt.blocked, title: translate("Toggle {groupName} filter").replace("{groupName}", titleForRender), "data-indeterminate": opt.partialChecked, children: opt.isWithAction ? null : labelElement }), opt.isWithAction && labelElement] }, `li_${ind}_${opt.property}`);
            }) }) : null;
    };
    return (0, jsx_runtime_1.jsxs)("div", { className: (0, classNames_1.classNames)(["zen-checkbox-list-with-action", driveComponentClass || "", className || ""]), children: [label ? (0, jsx_runtime_1.jsx)("div", { className: "zen-checkbox-list-with-action__title", children: label }) : null, build(options)] });
};
exports.CheckboxListWithAction = CheckboxListWithAction;
exports.TRANSLATIONS = [
    "View {groupName} children",
    "Toggle {groupName} filter",
    "Number of selected child groups - {count}"
];
