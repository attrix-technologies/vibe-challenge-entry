"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.List = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const useDragAndDrop_1 = require("./hooks/useDragAndDrop");
const isDataListitem_1 = require("./utils/isDataListitem");
const useDrive_1 = require("../utils/theme/useDrive");
const useMobile_1 = require("../commonHelpers/hooks/useMobile");
const viewportProvider_1 = require("./viewportProvider/viewportProvider");
const useVirtualScroll_1 = require("./hooks/useVirtualScroll");
const useLazyLoading_1 = require("./hooks/useLazyLoading");
const getLoadingItems_1 = require("./utils/getLoadingItems");
const classNames_1 = require("../commonHelpers/classNames/classNames");
const List = ({ type, children, onChangeOrder, checked, onCheck, onListEnd, isLoading, waitingItems, className }) => {
    const listId = (0, react_1.useId)();
    const listRef = (0, react_1.useRef)(null);
    const onChangeOrderCallback = (0, react_1.useCallback)((startPosition, endPosition) => {
        if (onChangeOrder) {
            onChangeOrder(startPosition, endPosition);
        }
    }, [onChangeOrder]);
    const { onDragStart } = (0, useDragAndDrop_1.useDragAndDrop)(listRef, onChangeOrderCallback);
    const isDrive = (0, useDrive_1.useDrive)();
    const isMobile = (0, useMobile_1.useMobile)();
    const { isInViewport } = (0, useVirtualScroll_1.useVirtualScroll)(listRef, children);
    (0, useLazyLoading_1.useLazyLoading)(listRef, isLoading, onListEnd);
    const childrenArray = (0, react_1.useMemo)(() => react_1.Children.map(children, (child) => {
        const props = {
            isDrive: isDrive,
            isMobile: isMobile
        };
        if (onChangeOrder) {
            props.onDragStart = onDragStart;
        }
        if (onCheck && checked && (0, isDataListitem_1.isDataListItem)(child)) {
            const id = child.props.id;
            props.checked = checked.indexOf(id) > -1;
            props.onCheck = (itemChecked) => onCheck(itemChecked ? [...checked, id] : checked.filter((c) => c !== id));
        }
        if (Object.keys(props).length > 0) {
            return (0, react_1.cloneElement)(child, props);
        }
        return child;
    }), [checked, children, isDrive, isMobile, onChangeOrder, onCheck, onDragStart]);
    const loadingChildren = (0, react_1.useMemo)(() => {
        if (!isLoading) {
            return null;
        }
        const defaultWaitingItems = type === "data" ? 50 : 10;
        return (0, getLoadingItems_1.getLoadingItems)(type || "standard", waitingItems || defaultWaitingItems, listId, isDrive, isMobile);
    }, [isDrive, isLoading, isMobile, listId, type, waitingItems]);
    return (0, jsx_runtime_1.jsx)(viewportProvider_1.ViewportProvider, { isInViewport: isInViewport, children: (0, jsx_runtime_1.jsxs)("ul", { className: (0, classNames_1.classNames)(["zen-list", className || ""]), ref: listRef, children: [childrenArray, loadingChildren] }) });
};
exports.List = List;
