"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ListItem = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const iconGrab_1 = require("../../icons/iconGrab");
const button_1 = require("../../button/button");
const useMobile_1 = require("../../commonHelpers/hooks/useMobile");
const menu_1 = require("../../menu/menu");
const useLanguage_1 = require("../../utils/localization/useLanguage");
const iconDotVertical_1 = require("../../icons/iconDotVertical");
const interfaces_1 = require("../interfaces");
const useDriveClassName_1 = require("../../utils/theme/useDriveClassName");
const classNames_1 = require("../../commonHelpers/classNames/classNames");
const useIconSize_1 = require("../../utils/theme/useIconSize");
const iconChevronRight_1 = require("../../icons/iconChevronRight");
const isActiveElement_1 = require("../utils/isActiveElement");
const ListItem = ({ id, className, image, name, secondary, status, actions, onClick, link, target, onDragStart }) => {
    const isMobile = (0, useMobile_1.useMobile)();
    const driveClassName = (0, useDriveClassName_1.useDriveClassName)("zen-list-item");
    const iconSize = (0, useIconSize_1.useIconSize)();
    const { translate } = (0, useLanguage_1.useLanguage)();
    const itemRef = (0, react_1.useRef)(null);
    const renderActions = (0, react_1.useCallback)(() => {
        if (!actions || actions.length === 0) {
            return null;
        }
        const { primaryActions, secondaryActions } = actions.reduce((acc, action) => {
            if (!isMobile && action.hasOwnProperty("icon")) {
                acc.primaryActions.push(action);
            }
            else {
                acc.secondaryActions.push(action);
            }
            return acc;
        }, { primaryActions: [], secondaryActions: [] });
        const buttons = (0, jsx_runtime_1.jsx)("div", { className: "zen-list-item__actions", children: primaryActions.map((action) => (0, jsx_runtime_1.jsx)(button_1.Button, { type: "tertiary-black", className: "zen-list-item__action-button", onClick: (0, interfaces_1.isButtonAction)(action) ? action.onClick : undefined, link: !(0, interfaces_1.isButtonAction)(action) ? action.link : undefined, children: action.icon ? (0, react_1.createElement)(action.icon, { size: iconSize }) : null }, action.name)) });
        const menu = secondaryActions.length > 0
            ? (0, jsx_runtime_1.jsx)(menu_1.Menu, { alignment: "bottom-right", title: translate("More"), trigger: (0, jsx_runtime_1.jsx)(button_1.Button, { type: "tertiary-black", className: "zen-list-item__more-button", children: (0, jsx_runtime_1.jsx)(iconDotVertical_1.IconDotVertical, { size: "large" }) }), children: secondaryActions.map((action) => (0, jsx_runtime_1.jsx)(menu_1.Menu.Item, { id: action.name, name: action.name, onClick: (0, interfaces_1.isButtonAction)(action) ? action.onClick : undefined, link: !(0, interfaces_1.isButtonAction)(action) ? action.link : undefined }, action.name)) })
            : null;
        return (0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [buttons, menu] });
    }, [actions, iconSize, isMobile, translate]);
    const isDndElement = (0, react_1.useCallback)((el) => {
        if (!el) {
            return false;
        }
        if (typeof el.className !== "string") {
            return false;
        }
        return el.className.indexOf("zen-list-item__dnd") !== -1;
    }, []);
    const handleClick = (0, react_1.useCallback)((e) => {
        if (!onClick && !link) {
            return;
        }
        if ((0, isActiveElement_1.isActiveElement)(e.target) || isDndElement(e.target)) {
            return;
        }
        if (onClick) {
            onClick();
            return;
        }
        if (itemRef.current) {
            const linkEl = itemRef.current.querySelector(".zen-list-item__click");
            linkEl === null || linkEl === void 0 ? void 0 : linkEl.click();
        }
    }, [isDndElement, link, onClick]);
    const clickableClassName = (0, react_1.useMemo)(() => onClick || link ? "zen-list-item--clickable" : "", [link, onClick]);
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    return (0, jsx_runtime_1.jsxs)("li", { id: id, className: (0, classNames_1.classNames)(["zen-list-item", driveClassName || "", clickableClassName, className || ""]), onClick: handleClick, ref: itemRef, children: [onDragStart ? (0, jsx_runtime_1.jsx)("div", { className: "zen-list-item__dnd", onPointerDown: onDragStart, children: (0, jsx_runtime_1.jsx)(iconGrab_1.IconGrab, { size: "large" }) }) : null, image ? (0, jsx_runtime_1.jsx)("div", { className: "zen-list-item__image", children: image }) : null, (0, jsx_runtime_1.jsxs)("div", { className: "zen-list-item__identifier", children: [(0, jsx_runtime_1.jsx)("div", { className: "zen-list-item__name", children: name }), (0, jsx_runtime_1.jsx)("div", { className: "zen-list-item__secondary", children: secondary })] }), status ? (0, jsx_runtime_1.jsx)("div", { className: "zen-list-item__status", children: status }) : null, renderActions(), onClick || link ? (0, jsx_runtime_1.jsx)(button_1.Button, { type: "tertiary-black", className: "zen-list-item__click", onClick: onClick, link: link, target: target, children: (0, jsx_runtime_1.jsx)(iconChevronRight_1.IconChevronRight, { size: "large", className: "zen-list-item__click-icon" }) }) : null] });
};
exports.ListItem = ListItem;
