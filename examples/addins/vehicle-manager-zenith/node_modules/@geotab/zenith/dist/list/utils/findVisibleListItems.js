"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.findVisibleListItems = void 0;
const findFirstVisible = (rows, top, rangeStart, rangeEnd) => {
    const middle = Math.floor((rangeStart + rangeEnd) / 2);
    const row = rows[middle];
    const rowTop = row.getBoundingClientRect().top;
    if (rowTop >= top) {
        if (middle - rangeStart <= 1) {
            return middle;
        }
        return findFirstVisible(rows, top, rangeStart, middle);
    }
    if (rangeEnd - middle <= 1) {
        return middle;
    }
    return findFirstVisible(rows, top, middle, rangeEnd);
};
const findVisibleListItems = (rows, top, bottom) => {
    if (rows.length === 0) {
        return [];
    }
    let foundVisible = false;
    let from = 0;
    let to = 0;
    const rowsLength = rows.length;
    const firstVisible = findFirstVisible(rows, top, 0, rowsLength - 1);
    const startIndex = Math.max(0, firstVisible - 1);
    for (let i = startIndex; i < rowsLength; i++) {
        const row = rows[i];
        const { top: rowTop, bottom: rowBottom } = row.getBoundingClientRect();
        if (rowTop >= top && rowBottom <= bottom) {
            if (!foundVisible) {
                from = i - 1;
            }
            foundVisible = true;
            continue;
        }
        // if we found visible rows, then we can stop searching
        if (foundVisible) {
            // add last row if it is partially visible and next one for correct keyboard navigation with lazy loading
            to = i + 1;
            break;
        }
    }
    // if we found visible rows, but the last row is not visible, then we need to add it
    if (foundVisible && to === 0) {
        to = rowsLength - 1;
    }
    const visibleRows = [];
    if (from <= to) {
        from = Math.max(0, from);
        to = Math.min(rows.length - 1, to);
        for (let i = from; i <= to; ++i) {
            visibleRows.push(rows[i]);
        }
    }
    return visibleRows;
};
exports.findVisibleListItems = findVisibleListItems;
