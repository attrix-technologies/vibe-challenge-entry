"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ColumnsPopup = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const columnSettings_1 = require("./columnSettings");
const popup_1 = require("../../popup/popup");
const columnsList_1 = require("./columnsList");
const ColumnsPopup = ({ onReset, onChange, columnSettings, columns, sortGroups, sortColumns, triggerRef }) => {
    const onResetListener = (0, react_1.useCallback)(() => {
        onReset();
    }, [onReset]);
    const listOfColumns = (0, react_1.useMemo)(() => {
        var _a;
        const firstColumn = ((_a = columns[0]) === null || _a === void 0 ? void 0 : _a.id) || "";
        const columnSettingsMap = new Map(columnSettings.map(s => [s.name, s.visible]));
        return (0, jsx_runtime_1.jsx)(columnsList_1.ColumnSettingsList, { columns: columns.filter(c => c.title), settings: columnSettingsMap, firstColumn: firstColumn, onChange: (newSettings) => {
                const settings = (columnSettings.map(s => {
                    const visible = newSettings.get(s.name) !== false;
                    return Object.assign(Object.assign({}, s), { visible });
                }));
                onChange(settings);
            }, sortGroups: sortGroups, sortColumns: sortColumns });
    }, [columns, columnSettings, sortGroups, sortColumns, onChange]);
    return (0, jsx_runtime_1.jsx)(popup_1.Popup, { triggerRef: triggerRef, alignment: "bottom-right", children: (0, jsx_runtime_1.jsx)(columnSettings_1.ColumnSettings, { onReset: onResetListener, children: listOfColumns }) }, "flexible-popup");
};
exports.ColumnsPopup = ColumnsPopup;
