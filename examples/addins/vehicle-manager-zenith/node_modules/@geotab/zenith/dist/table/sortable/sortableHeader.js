"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SortableHeaderCell = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const interfaces_1 = require("./interfaces");
const textIconButton_1 = require("../../textIconButton/textIconButton");
const iconFilter3Asc_1 = require("../../icons/iconFilter3Asc");
const useLanguage_1 = require("../../utils/localization/useLanguage");
const iconFilter3Desc_1 = require("../../icons/iconFilter3Desc");
const classNames_1 = require("../../commonHelpers/classNames/classNames");
const getSortButtonTitle = (sortDirection, title, translate) => {
    const titleTemplate = sortDirection === interfaces_1.ColumnSortDirection.Descending ? "Sort by {COLUMN_NAME} descending" : "Sort by {COLUMN_NAME} ascending";
    return translate(titleTemplate).replace("{COLUMN_NAME}", title);
};
const activeElementNames = new Set(["BUTTON", "A", "LABEL", "INPUT"]);
const isActiveElement = (element) => activeElementNames.has(element.nodeName);
const findParent = (element, className) => {
    if (element.classList.contains(className)) {
        return element;
    }
    if (isActiveElement(element)) {
        return element;
    }
    if (!element.parentElement) {
        return element;
    }
    return findParent(element.parentElement, className);
};
const isClickOnSortableParent = (element) => {
    const parent = findParent(element, "zen-sortable-column-button");
    return parent.classList.contains("zen-sortable-column-button") || parent.classList.contains("zen-sortable-column-button__dir-icon");
};
const SortableHeaderCell = ({ columnName, isSortedBy, sortDirection, title, tooltip, onSortChange, isMobile = false, initialSortDirection = interfaces_1.ColumnSortDirection.Ascending }) => {
    const { translate } = (0, useLanguage_1.useLanguage)();
    const [isHovered, setIsHovered] = (0, react_1.useState)(false);
    const [isFocused, setIsFocused] = (0, react_1.useState)(false);
    const isActive = isHovered || isFocused;
    const iconTitleText = (0, react_1.useMemo)(() => {
        switch (sortDirection) {
            case interfaces_1.ColumnSortDirection.Ascending: {
                return interfaces_1.ColumnSortDirection.Descending;
            }
            case interfaces_1.ColumnSortDirection.Descending: {
                return interfaces_1.ColumnSortDirection.Ascending;
            }
            case undefined:
            default:
                return initialSortDirection;
        }
    }, [sortDirection, initialSortDirection]);
    const iconTitle = getSortButtonTitle(iconTitleText, tooltip, translate);
    const icon = (0, react_1.useMemo)(() => {
        switch (sortDirection) {
            case interfaces_1.ColumnSortDirection.Ascending: {
                return isActive ? iconFilter3Desc_1.IconFilter3Desc : iconFilter3Asc_1.IconFilter3Asc;
            }
            case interfaces_1.ColumnSortDirection.Descending:
                return isActive ? iconFilter3Asc_1.IconFilter3Asc : iconFilter3Desc_1.IconFilter3Desc;
            case undefined:
            default: {
                return initialSortDirection === interfaces_1.ColumnSortDirection.Ascending ? iconFilter3Asc_1.IconFilter3Asc : iconFilter3Desc_1.IconFilter3Desc;
            }
        }
    }, [sortDirection, isActive, initialSortDirection]);
    const iconButton = ((0, jsx_runtime_1.jsx)(textIconButton_1.TextIconButton, { className: "zen-sortable-column-button__dir-icon zen-caption__post-icon", icon: icon, iconPosition: isMobile ? textIconButton_1.ButtonIconPosition.Start : textIconButton_1.ButtonIconPosition.End, type: "tertiary-black", title: iconTitle }));
    const onHeaderClick = (0, react_1.useCallback)((e) => {
        const target = e && e.target;
        if (!target) {
            return;
        }
        if (isClickOnSortableParent(target)) {
            onSortChange({
                sortColumn: columnName,
                sortDirection: sortDirection === undefined ? initialSortDirection :
                    sortDirection === interfaces_1.ColumnSortDirection.Ascending
                        ? interfaces_1.ColumnSortDirection.Descending
                        : interfaces_1.ColumnSortDirection.Ascending
            });
        }
    }, [onSortChange, columnName, sortDirection, initialSortDirection]);
    return ((0, jsx_runtime_1.jsx)("div", { onMouseEnter: () => setIsHovered(true), onMouseLeave: () => setIsHovered(false), onFocus: () => setIsFocused(true), onBlur: () => setIsFocused(false), className: (0, classNames_1.classNames)([
            "zen-sortable-column",
            isSortedBy ? `zen-sortable-column--active` : "",
            isMobile ? `zen-sortable-column--mobile` : ""
        ]), children: (0, jsx_runtime_1.jsx)("div", { className: (0, classNames_1.classNames)([
                "zen-caption",
                "zen-sortable-column__button",
                "zen-sortable-column-button",
                isSortedBy ? `zen-sortable-column-button--active` : "",
                sortDirection === interfaces_1.ColumnSortDirection.Ascending
                    ? "zen-sortable-column-button--dir-asc"
                    : "zen-sortable-column-button--dir-desc"
            ]), title: iconTitle, "aria-label": iconTitle, onClick: onHeaderClick, children: (0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [isMobile ? iconButton : null, (0, jsx_runtime_1.jsx)("div", { className: "zen-sortable-column-button__content zen-caption__content", children: title }), isMobile ? null : iconButton] }) }) }));
};
exports.SortableHeaderCell = SortableHeaderCell;
