"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataGridCell = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const classNames_1 = require("../../commonHelpers/classNames/classNames");
const basicColumn_1 = require("../columns/basicColumn");
const isActiveElement_1 = require("../../list/utils/isActiveElement");
const Cell = ({ index, limited, visibleOnHover, isVisible, width, render, renderWrappers, renderPlaceholder, defaultValue, entity, colspan, className, onClick }) => {
    const [content, setContent] = (0, react_1.useState)("");
    const placeholderRenderer = (0, react_1.useCallback)(() => {
        const renderFn = renderPlaceholder || (() => "...");
        const value = renderFn(entity);
        return renderWrappers(value, entity);
    }, [entity, renderPlaceholder, renderWrappers]);
    const renderer = (0, react_1.useCallback)(async () => {
        let result = render(entity);
        if (result === undefined || result === null) {
            result = defaultValue;
        }
        if (!(0, basicColumn_1.isPromiseLike)(result)) {
            return renderWrappers(result, entity);
        }
        try {
            let postponedResult = await result;
            if (postponedResult === undefined) {
                postponedResult = defaultValue;
            }
            return renderWrappers(postponedResult, entity);
        }
        catch (e) {
            console.error(e);
            return "";
        }
    }, [defaultValue, entity, render, renderWrappers]);
    (0, react_1.useEffect)(() => {
        if (!isVisible) {
            setContent("");
            return;
        }
        const placeholderTimeout = requestAnimationFrame(() => {
            setContent(placeholderRenderer());
        });
        renderer().then(res => {
            cancelAnimationFrame(placeholderTimeout);
            setContent(res);
        }).catch(() => {
            cancelAnimationFrame(placeholderTimeout);
            setContent("");
        });
    }, [isVisible, entity, renderer, placeholderRenderer]);
    const onCellClick = (0, react_1.useCallback)((e) => {
        if (onClick && !(0, isActiveElement_1.isActiveElement)(e.target)) {
            onClick();
        }
    }, [onClick]);
    return (0, jsx_runtime_1.jsx)("td", { colSpan: colspan, onClick: onCellClick, className: (0, classNames_1.classNames)([
            "zen-data-grid__row-cell",
            className || "",
            index === 0 ? "zen-data-grid__row-cell--first" : "",
            visibleOnHover ? "zen-data-grid__row-cell--visible-on-hover" : "",
            onClick ? "zen-data-grid__row-cell--clickable" : "",
            limited ? "zen-ellipsis" : ""
        ]), style: { minWidth: width || "auto", maxWidth: width || "auto" }, role: "gridcell", children: content });
};
exports.DataGridCell = (0, react_1.memo)(Cell);
