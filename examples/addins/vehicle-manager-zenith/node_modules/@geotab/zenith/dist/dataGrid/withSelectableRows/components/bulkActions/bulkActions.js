"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.BulkActions = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const textIconButton_1 = require("../../../../textIconButton/textIconButton");
const classNames_1 = require("../../../../commonHelpers/classNames/classNames");
const react_1 = require("react");
const bulkActionLink_1 = require("./bulkActionLink/bulkActionLink");
const bulkActionButton_1 = require("./bulkActionButton/bulkActionButton");
const useLanguage_1 = require("../../../../utils/localization/useLanguage");
const iconClose_1 = require("../../../../icons/iconClose");
const deviceType_1 = require("../../../../commonHelpers/hooks/deviceType");
const useNonFittingElements_1 = require("../../../../header/hooks/useNonFittingElements");
const useResizeObserver_1 = require("../../../../commonHelpers/hooks/useResizeObserver");
const menu_1 = require("../../../../menu/menu");
const iconDotVertical_1 = require("../../../../icons/iconDotVertical");
const button_1 = require("../../../../button/button");
const BulkActions = ({ selected, allSelected, className, onClearSelection, onSelectAll, gridType = deviceType_1.DeviceType.Desktop, children, turnOffSelectAll }) => {
    var _a;
    const { translate } = (0, useLanguage_1.useLanguage)();
    const childrenArray = (0, react_1.useMemo)(() => react_1.Children.toArray(children), [children]);
    const buttonHolder = (0, react_1.useRef)(null);
    const bulkActionsElement = (0, react_1.useRef)(null);
    const moreButtonRef = (0, react_1.useRef)(null);
    const { result } = (0, useResizeObserver_1.useResizeObserver)({ target: buttonHolder.current });
    const widthDelta = ((_a = moreButtonRef.current) === null || _a === void 0 ? void 0 : _a.offsetWidth) || 32;
    const maxWidth = (result === null || result === void 0 ? void 0 : result.contentRect.width) || 1000;
    const { visibleElements, nonFittingElements, hiddenContainerRef } = (0, useNonFittingElements_1.useNonFittingElements)({ maxWidth, data: childrenArray, hiddenElementsCountToRender: 10, widthDelta });
    const isMobile = gridType === deviceType_1.DeviceType.Mobile;
    const text = translate("{1} selected").replace("{1}", allSelected ? translate("All") : selected.toFixed());
    return (0, jsx_runtime_1.jsxs)("div", { className: (0, classNames_1.classNames)(["zen-bulk-actions", className || "", isMobile ? "zen-bulk-actions--condensed" : ""]), ref: bulkActionsElement, children: [(0, jsx_runtime_1.jsx)(textIconButton_1.TextIconButton, { className: "zen-bulk-actions__button-clear", icon: iconClose_1.IconClose, iconPosition: textIconButton_1.ButtonIconPosition.Start, iconSize: "large", type: "tertiary-black", title: translate("Clear selection"), "aria-label": translate("Clear selection"), onClick: onClearSelection }), (0, jsx_runtime_1.jsx)("span", { className: "zen-bulk-actions__number-of-selected ellipsis", children: text }), onSelectAll && !turnOffSelectAll
                ? (0, jsx_runtime_1.jsx)(button_1.Button, { type: "tertiary", className: "zen-bulk-actions__select-all", disabled: allSelected, onClick: onSelectAll, children: translate("Select all") })
                : null, (0, jsx_runtime_1.jsxs)("div", { className: "zen-bulk-actions__action-button-holder", ref: buttonHolder, children: [react_1.Children.map(visibleElements, element => (0, react_1.cloneElement)(element, {
                        disabled: selected > 0 || allSelected ? element.props.disabled : true
                    })), nonFittingElements.length > 0
                        ? (0, jsx_runtime_1.jsx)(menu_1.Menu, { title: translate("More"), trigger: (0, jsx_runtime_1.jsx)(textIconButton_1.TextIconButton, { ref: moreButtonRef, className: "zen-bulk-actions__action-button zen-bulk-actions__action-button-more", icon: iconDotVertical_1.IconDotVertical, iconPosition: textIconButton_1.ButtonIconPosition.Start, iconSize: "large", type: isMobile ? "tertiary-black" : "secondary", title: translate("More"), "aria-label": translate("More") }), children: nonFittingElements.filter(el => el.props).map(child => (0, jsx_runtime_1.jsx)(menu_1.Menu.Item, { id: child.props.id, name: child.props.title, icon: child.props.icon, disabled: child.props.disabled, onClick: child.props.clickHandler, link: child.props.link }, child.props.id)) })
                        : null, (0, jsx_runtime_1.jsx)("div", { className: "zen-bulk-actions__hidden-elements", ref: hiddenContainerRef, children: childrenArray })] })] });
};
exports.BulkActions = BulkActions;
exports.BulkActions.ActionLink = bulkActionLink_1.BulkActionLink;
exports.BulkActions.ActionButton = bulkActionButton_1.BulkActionButton;
exports.BulkActions.translations = [
    "Clear selection",
    "More options",
    "{1} selected",
    "Selecting..."
];
