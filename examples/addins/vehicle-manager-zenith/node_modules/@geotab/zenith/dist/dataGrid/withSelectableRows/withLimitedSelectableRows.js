"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withLimitedSelectableRows = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const withSelectableRows_1 = require("./withSelectableRows");
const limitedCheckboxColumnWrapper_1 = require("../columns/checkboxColumn/limitedCheckboxColumnWrapper");
// T - type of entity
// P - props of wrapped component
/**
 * @deprecated Please use withSelectableRows with options checkboxVisible/checkboxDisabled instead
 */
// eslint-disable-next-line @typescript-eslint/naming-convention
const withLimitedSelectableRows = (DataGridComponent) => (0, react_1.forwardRef)(
// eslint-disable-next-line @typescript-eslint/naming-convention
function InnerList(props, ref) {
    const { selection, columns, options, onSelect, entities } = props;
    const allSelected = !!(selection === null || selection === void 0 ? void 0 : selection.allSelected);
    const selections = (0, withSelectableRows_1.getSelections)(allSelected ?
        { selected: entities.slice(0, options.limit).map(el => el.id), allSelected: false }
        : (selection ? { selected: selection.selected.slice(0, options.limit), allSelected: false } : undefined));
    const wrapper = (0, react_1.useMemo)(() => new limitedCheckboxColumnWrapper_1.LimitedCheckboxColumnWrapper(selections, { createTitle: options.createTitle, headerTitle: options.headerTitle, limit: props.options.limit }, { current: null }), [selections, options.createTitle, options.headerTitle, props.options.limit]);
    const onSelectListener = (0, react_1.useCallback)(([id, checked]) => {
        if (checked) {
            selections.add(id);
        }
        else {
            selections.delete(id);
        }
        onSelect({
            selected: [...selections],
            allSelected: false
        });
    }, [selections, onSelect]);
    (0, react_1.useEffect)(() => {
        wrapper.detach();
        wrapper.attach("change", onSelectListener);
        return () => {
            wrapper.detach();
        };
    }, [wrapper, onSelectListener]);
    const listColumns = (0, react_1.useMemo)(() => {
        const newColumns = columns.map(c => (Object.assign({}, c)));
        if (newColumns.length > 0) {
            newColumns[0].wrappers = [...(newColumns[0].wrappers || []), wrapper];
        }
        return newColumns;
    }, [columns, wrapper]);
    return (0, jsx_runtime_1.jsx)(DataGridComponent, Object.assign({}, props, { columns: listColumns, ref: ref }));
});
exports.withLimitedSelectableRows = withLimitedSelectableRows;
