"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FiltersBarSidePanelDropdownWithCheckbox = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const checkbox_1 = require("../../../../checkbox/checkbox");
const dropdown_1 = require("../../../../dropdown/dropdown");
const dropdownHelper_1 = require("../../../../dropdown/dropdownHelper");
const FiltersBarSidePanelDropdownWithCheckbox = ({ props, state, onChange, getData }) => {
    const isFullSelectionMode = (0, react_1.useMemo)(() => "isAllSelected" in state && typeof (state).isAllSelected === "boolean", [state]);
    const [checkboxValue, setCheckboxValue] = (0, react_1.useState)(state.isChecked);
    const [isCurrentAllSelected, setIsCurrentAllSelected] = (0, react_1.useState)(isFullSelectionMode ? state.isAllSelected : undefined);
    const [selection, setSelection] = (0, react_1.useState)(state.selected);
    const onChangeFullSelectionCheckboxFree = (0, react_1.useCallback)((newValue) => {
        setIsCurrentAllSelected(newValue.isAllSelected || false);
        setSelection(newValue.selected.map(el => el.id));
        onChange({ selected: newValue.selected.map(el => el.id), isAllSelected: newValue.isAllSelected || false, isChecked: checkboxValue });
    }, [onChange, checkboxValue]);
    const onChangeCheckboxFree = (0, react_1.useCallback)((newValue) => {
        setSelection(newValue.map(el => el.id));
        onChange({ selected: newValue.map(el => el.id), isChecked: checkboxValue });
    }, [onChange, checkboxValue]);
    const customGetDataFn = (0, react_1.useCallback)((signal, searchValue) => getData(signal, searchValue, checkboxValue), [checkboxValue, getData]);
    const handleCheckboxChange = (0, react_1.useCallback)((event) => {
        setCheckboxValue(event.target.checked);
        if (isFullSelectionMode) {
            onChange({ selected: selection, isAllSelected: isCurrentAllSelected || false, isChecked: event.target.checked });
        }
        else {
            onChange({ selected: selection, isChecked: event.target.checked });
        }
    }, [isCurrentAllSelected, isFullSelectionMode, onChange, selection]);
    (0, react_1.useEffect)(() => {
        if ((0, dropdownHelper_1.compareStringsArrays)(state.selected, selection)
            && state.isAllSelected === (isFullSelectionMode ? isCurrentAllSelected : undefined)
            && state.isChecked === checkboxValue) {
            return;
        }
        isFullSelectionMode && setIsCurrentAllSelected(state.isAllSelected);
        setSelection(state.selected);
        setCheckboxValue(state.isChecked);
    }, [checkboxValue, isCurrentAllSelected, isFullSelectionMode, selection, state]);
    const checkboxFreeComponent = isFullSelectionMode ? ((0, jsx_runtime_1.jsx)(dropdown_1.Dropdown, Object.assign({}, props, { checkboxLabel: undefined, getData: customGetDataFn, value: { selected: Array.from(selection), isAllSelected: isCurrentAllSelected || false }, onChange: onChangeFullSelectionCheckboxFree, defaultValue: typeof props.defaultValue !== "undefined" ?
            { selected: props.defaultValue.selected, isAllSelected: props.defaultValue.isAllSelected || false }
            : undefined, multiselect: true, selectAllButton: true }))) : ((0, jsx_runtime_1.jsx)(dropdown_1.Dropdown, Object.assign({}, props, { checkboxLabel: undefined, getData: customGetDataFn, value: Array.from(selection), onChange: onChangeCheckboxFree, defaultValue: typeof props.defaultValue !== "undefined" ?
            props.defaultValue.selected
            : undefined })));
    return (0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [checkboxFreeComponent, (0, jsx_runtime_1.jsx)("div", { className: "zen-filters-bar-dropdown-with-checkbox__side-panel-checkbox", children: (0, jsx_runtime_1.jsx)(checkbox_1.Checkbox, { checked: checkboxValue, onChange: handleCheckboxChange, children: props.checkboxLabel }) })] });
};
exports.FiltersBarSidePanelDropdownWithCheckbox = FiltersBarSidePanelDropdownWithCheckbox;
