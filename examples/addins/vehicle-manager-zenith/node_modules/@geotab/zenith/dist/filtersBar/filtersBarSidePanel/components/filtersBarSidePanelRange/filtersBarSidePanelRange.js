"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FiltersBarSidePanelRange = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const classNames_1 = require("../../../../commonHelpers/classNames/classNames");
const rangeHelper_1 = require("../../../../range/rangeHelper");
const useLanguage_1 = require("../../../../utils/localization/useLanguage");
const rangeField_1 = require("../../../../range/rangeField");
const useDirection_1 = require("../../hooks/useDirection");
const useMobile_1 = require("../../../../commonHelpers/hooks/useMobile");
const formFieldError_1 = require("../../../../formFieldError/formFieldError");
const FiltersBarSidePanelRange = ({ className, id, onChange, value, unit, min, max, fullBounded, allowEqualMinMax, labelMin, labelMax, disabled }) => {
    const generatedId = (0, react_1.useId)();
    const intId = id || generatedId;
    const [currentValue, setCurrentValue] = (0, react_1.useState)(value);
    const [errorType, setErrorType] = (0, react_1.useState)(undefined);
    const prevValueRef = (0, react_1.useRef)(value);
    const minRef = (0, react_1.useRef)(null);
    const maxRef = (0, react_1.useRef)(null);
    const { translate } = (0, useLanguage_1.useLanguage)();
    const handleChange = (0, react_1.useCallback)((targetId, newValue) => {
        const newValues = { min: targetId === "min" ? newValue : currentValue.min, max: targetId === "max" ? newValue : currentValue.max };
        setCurrentValue(newValues);
        const currentErrorType = (0, rangeHelper_1.checkErrorType)(currentValue.min, currentValue.max, fullBounded, allowEqualMinMax, min, max);
        setErrorType(currentErrorType);
        onChange(newValues);
    }, [currentValue.min, currentValue.max, fullBounded, allowEqualMinMax, min, max, onChange]);
    (0, react_1.useEffect)(() => {
        const currentErrorType = (0, rangeHelper_1.checkErrorType)(currentValue.min, currentValue.max, fullBounded, allowEqualMinMax, min, max);
        setErrorType(currentErrorType);
    }, [currentValue.min, currentValue.max, fullBounded, allowEqualMinMax, errorType, min, max]);
    (0, react_1.useEffect)(() => {
        if (value.min === prevValueRef.current.min && value.max === prevValueRef.current.max) {
            return;
        }
        prevValueRef.current = value;
        if (value.min !== currentValue.min || value.max !== currentValue.max) {
            setCurrentValue(value);
        }
    }, [currentValue.min, currentValue.max, value]);
    const { directionState, setContainerNode } = (0, useDirection_1.useDirection)();
    const isMobile = (0, useMobile_1.useMobile)();
    const setFieldsContainerRef = (0, react_1.useCallback)((node) => {
        setContainerNode(node);
    }, [setContainerNode]);
    const rangeFieldClasses = (0, react_1.useMemo)(() => (0, classNames_1.classNames)([
        "zen-filters-bar-side-panel-range__item",
        isMobile ? "zen-filters-bar-side-panel-range__item--mobile" : "",
        directionState === "column" ? "zen-filters-bar-side-panel-range__item--column" : "zen-filters-bar-side-panel-range__item--row"
    ]), [directionState, isMobile]);
    const rangeFieldContainerClasses = (0, react_1.useMemo)(() => (0, classNames_1.classNames)([
        "zen-filters-bar-side-panel-range__items-container",
        directionState === "column" ? "zen-filters-bar-side-panel-range__items-container--column" : "zen-filters-bar-side-panel-range__items-container--row"
    ]), [directionState]);
    const memoizedMinRangeField = (0, react_1.useMemo)(() => (0, jsx_runtime_1.jsx)(rangeField_1.RangeField, { className: (0, classNames_1.classNames)([rangeFieldClasses, "zen-filters-bar-side-panel-range__min-field"]), label: labelMin || translate("Min"), unit: unit, value: currentValue.min, id: "min", inputRef: minRef, errorString: (0, rangeHelper_1.getErrorString)("min", currentValue.min, translate, errorType, min, max), onChange: handleChange, max: max, min: min, isMinField: true, direction: directionState, disabled: disabled }), [rangeFieldClasses, labelMin, translate, unit, currentValue.min, errorType, min, max, handleChange, directionState, disabled]);
    const memoizedMaxRangeField = (0, react_1.useMemo)(() => (0, jsx_runtime_1.jsx)(rangeField_1.RangeField, { className: (0, classNames_1.classNames)([rangeFieldClasses, "zen-filters-bar-side-panel-range__max-field"]), label: labelMax || translate("Max"), unit: unit, value: currentValue.max, id: "max", inputRef: maxRef, errorString: (0, rangeHelper_1.getErrorString)("max", currentValue.max, translate, errorType, min, max), onChange: handleChange, max: max, min: min, isMinField: false, direction: directionState, disabled: disabled }), [rangeFieldClasses, labelMax, translate, unit, currentValue.max, errorType, min, max, handleChange, directionState, disabled]);
    return (0, jsx_runtime_1.jsxs)("div", { ref: setFieldsContainerRef, id: intId, className: (0, classNames_1.classNames)(["zen-filters-bar-side-panel-range", className || ""]), children: [(0, jsx_runtime_1.jsxs)("div", { className: rangeFieldContainerClasses, children: [memoizedMinRangeField, memoizedMaxRangeField] }), errorType !== undefined && directionState === "row" ? (0, jsx_runtime_1.jsx)(formFieldError_1.FormFieldError, { className: "zen-filters-bar-side-panel-range__error", error: [(0, rangeHelper_1.getErrorString)("min", currentValue.min, translate, errorType, min, max) || "", (0, rangeHelper_1.getErrorString)("max", currentValue.max, translate, errorType, min, max) || ""] })
                : null] });
};
exports.FiltersBarSidePanelRange = FiltersBarSidePanelRange;
