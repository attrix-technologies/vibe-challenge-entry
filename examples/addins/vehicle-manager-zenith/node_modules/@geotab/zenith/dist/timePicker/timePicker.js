"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TRANSLATIONS = exports.TimePicker = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const classNames_1 = require("../commonHelpers/classNames/classNames");
const filterButton_1 = require("../filterButton/filterButton");
const react_1 = require("react");
const buttonType_1 = require("../button/buttonType");
const controlledPopup_1 = require("../controlledPopup/controlledPopup");
const timeSelect_1 = require("./components/timeSelect/timeSelect");
const button_1 = require("../button/button");
const timePickerUtils_1 = require("./timePickerUtils");
const useLanguage_1 = require("../utils/localization/useLanguage");
const formFieldError_1 = require("../formFieldError/formFieldError");
const hours = (0, timePickerUtils_1.getSelectItemsForTimePicker)(23);
const minutes = (0, timePickerUtils_1.getSelectItemsForTimePicker)(59);
const TimePicker = ({ className, disabled, fullWidth, value, onChange, isMobileView, dataTimeId, error }) => {
    const { translate } = (0, useLanguage_1.useLanguage)();
    const classes = (0, classNames_1.classNames)(["zen-time-picker", disabled ? "zen-time-picker--disabled" : "", className || ""]);
    const innerTriggerRef = (0, react_1.useRef)(null);
    const [isOpen, setIsOpen] = (0, react_1.useState)(false);
    const hourValue = value ? value.getHours().toString().padStart(2, "0") : "";
    const minutesValue = value ? value.getMinutes().toString().padStart(2, "0") : "";
    const [timeValue, setTimeValue] = (0, react_1.useState)({ hour: hourValue, minutes: minutesValue });
    const onCancelHandler = () => {
        setTimeValue({ hour: hourValue, minutes: minutesValue });
        setIsOpen(false);
    };
    const onApplyHandler = () => {
        if (!timeValue.hour && !timeValue.minutes) {
            setIsOpen(false);
            return;
        }
        setTimeValue(timeValue);
        setIsOpen(false);
        const copyDate = value ? new Date(value) : new Date();
        copyDate.setHours(parseInt(timeValue.hour || "00"));
        copyDate.setMinutes(parseInt(timeValue.minutes || "00"));
        onChange(copyDate);
    };
    (0, react_1.useEffect)(() => {
        if (!isOpen) {
            setTimeValue({ hour: hourValue, minutes: minutesValue });
        }
    }, [hourValue, isOpen, minutesValue]);
    const triggerClassName = (0, classNames_1.classNames)(["zen-time-picker__trigger", error ? "zen-time-picker__trigger--error" : "", className || ""]);
    return (0, jsx_runtime_1.jsxs)("div", { className: classes, children: [(0, jsx_runtime_1.jsx)(filterButton_1.FilterButton, Object.assign({ ref: innerTriggerRef, className: triggerClassName, onClick: () => {
                    setIsOpen(!isOpen);
                }, disabled: disabled, isActive: isOpen, fullWidth: fullWidth }, (dataTimeId ? { "data-time": dataTimeId } : {}), { children: `${hourValue || "24"}:${minutesValue || "00"}` })), (0, jsx_runtime_1.jsx)(formFieldError_1.FormFieldError, { error: error }), (0, jsx_runtime_1.jsx)(controlledPopup_1.ControlledPopup, { useTrapFocusWithTrigger: "on", alignment: "bottom", onOpenChange: setIsOpen, isOpen: isOpen, triggerRef: innerTriggerRef, recalculateOnScroll: true, className: (0, classNames_1.classNames)(["zen-time-picker__popup", isMobileView ? "zen-time-picker__popup--mobile" : ""]), children: (0, jsx_runtime_1.jsxs)("div", { className: "zen-time-picker-select", children: [(0, jsx_runtime_1.jsxs)("div", { className: "zen-time-picker-select__wrapper", children: [(0, jsx_runtime_1.jsx)(timeSelect_1.TimeSelect, { title: translate("Select hour"), selected: timeValue.hour, items: hours, onSelect: (newHourValue) => {
                                        setTimeValue(Object.assign(Object.assign({}, timeValue), { hour: newHourValue }));
                                    } }), (0, jsx_runtime_1.jsx)("div", { className: "zen-time-picker-select__separator" }), (0, jsx_runtime_1.jsx)(timeSelect_1.TimeSelect, { title: translate("Select minutes"), selected: timeValue.minutes, items: minutes, onSelect: (newMinutesValue) => {
                                        setTimeValue(Object.assign(Object.assign({}, timeValue), { minutes: newMinutesValue }));
                                    } })] }), (0, jsx_runtime_1.jsxs)("div", { className: "zen-time-picker-select__footer", children: [isMobileView ? (0, jsx_runtime_1.jsx)(button_1.Button, { type: buttonType_1.ButtonType.Primary, onClick: onApplyHandler, title: translate("Apply changes"), className: "zen-time-picker-select__footer-button", children: translate("Apply") }) : null, (0, jsx_runtime_1.jsx)(button_1.Button, { type: buttonType_1.ButtonType.Tertiary, onClick: onCancelHandler, title: translate("Cancel changes"), className: "zen-time-picker-select__footer-button", children: translate("Cancel") }), isMobileView ? null : (0, jsx_runtime_1.jsx)(button_1.Button, { type: buttonType_1.ButtonType.Primary, onClick: onApplyHandler, title: translate("Apply changes"), className: "zen-time-picker-select__footer-button", children: translate("Apply") })] })] }) })] });
};
exports.TimePicker = TimePicker;
exports.TRANSLATIONS = [
    "Select hour",
    "Select minutes",
    "Cancel",
    "Apply",
    "Cancel changes",
    "Apply changes"
];
