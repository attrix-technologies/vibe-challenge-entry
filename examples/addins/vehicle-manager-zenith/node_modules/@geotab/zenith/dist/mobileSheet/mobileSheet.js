"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TRANSLATIONS = exports.MobileSheet = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const sidePanel_1 = require("../sidePanel/sidePanel");
const shield_1 = require("../shield/shield");
const classNames_1 = require("../commonHelpers/classNames/classNames");
const mobileSheetFooter_1 = require("./components/mobileSheetFooter");
const mobileSheetContent_1 = require("./components/mobileSheetContent");
const mobileSheetTitle_1 = require("./components/mobileSheetTitle");
const buttonType_1 = require("../button/buttonType");
const textIconButton_1 = require("../textIconButton/textIconButton");
const iconBackArrow_1 = require("../icons/deprecated/iconBackArrow");
const iconClose_1 = require("../icons/iconClose");
const focusableSelector_1 = require("../utils/focusableSelector");
const useDrive_1 = require("../utils/theme/useDrive");
const useDriveClassName_1 = require("../utils/theme/useDriveClassName");
const useLanguage_1 = require("../utils/localization/useLanguage");
const useUniqueId_1 = require("../commonHelpers/useUniqueId");
const useFadeComponent_1 = require("../utils/useFadeComponent");
// eslint-disable-next-line @typescript-eslint/naming-convention
const MobileSheet = 
// eslint-disable-next-line react/prop-types
({ triggerRef, label, isOpen, onHidePanel, className = "", panelPosition = "bottom", onBackClick, onCloseClick, isBackVisible, backButtonAriaLabel, children, useTrapFocusWithTrigger, onReadyForFocus, wrapperClassName }) => {
    var _a, _b;
    const { renderComponent, showContent, readyForFocus, setIsOpen, handleTransitionEnd } = (0, useFadeComponent_1.useFadeComponent)(isOpen, onReadyForFocus);
    const dataShieldId = (0, useUniqueId_1.useUniqueId)();
    const { translate } = (0, useLanguage_1.useLanguage)();
    const ref = (0, react_1.useRef)(null);
    const isDrive = (0, useDrive_1.useDrive)();
    const driveWrapperMobileSheetClassName = (0, useDriveClassName_1.useDriveClassName)("zen-mobile-sheet-wrapper");
    const driveTitleClassName = (0, useDriveClassName_1.useDriveClassName)("zen-mobile-sheet__title");
    const driveFooterClassName = (0, useDriveClassName_1.useDriveClassName)("zen-mobile-sheet__footer");
    const [content, footer, title] = (0, react_1.useMemo)(() => {
        const c = [];
        const f = [];
        const t = [];
        react_1.Children.forEach(children, (child) => {
            if (!f.length && child.type === exports.MobileSheet.Footer) {
                f.push(child);
                return;
            }
            if (!c.length && child.type === exports.MobileSheet.Content) {
                c.push(child);
                return;
            }
            if (!t.length && child.type === exports.MobileSheet.Title) {
                t.push(child);
                return;
            }
        });
        return [c, f, t];
    }, [children]);
    const onHidePanelAction = (0, react_1.useCallback)((reason, shieldId) => {
        if (reason === sidePanel_1.SidePanelCloseReason.ClickOutside && shieldId === dataShieldId || reason === sidePanel_1.SidePanelCloseReason.Escape) {
            onHidePanel(reason);
            return;
        }
    }, [onHidePanel, dataShieldId]);
    (0, react_1.useEffect)(() => {
        setIsOpen(isOpen);
    }, [isOpen, setIsOpen]);
    (0, react_1.useEffect)(() => {
        var _a, _b;
        if (useTrapFocusWithTrigger) {
            return;
        }
        showContent && ((_b = (_a = ref.current) === null || _a === void 0 ? void 0 : _a.querySelector(focusableSelector_1.FOCUSABLE_SELECTOR)) === null || _b === void 0 ? void 0 : _b.focus());
    }, [content, showContent, readyForFocus, useTrapFocusWithTrigger]);
    (0, react_1.useEffect)(() => {
        var _a;
        if (!renderComponent && !readyForFocus && ((_a = triggerRef.current) === null || _a === void 0 ? void 0 : _a.getAttribute("aria-expanded")) === "true") {
            triggerRef.current.setAttribute("aria-expanded", "false");
            triggerRef.current.focus();
        }
    }, [triggerRef, renderComponent, readyForFocus]);
    if (!renderComponent && !isOpen) {
        return null;
    }
    return (0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)(shield_1.Shield, { className: "zen-mobile-sheet-shield", dataShieldId: dataShieldId, isVisible: showContent }), (0, jsx_runtime_1.jsx)(sidePanel_1.SidePanel, { className: (0, classNames_1.classNames)(["zen-mobile-sheet-wrapper", wrapperClassName || "", driveWrapperMobileSheetClassName || ""]), panelPosition: panelPosition, triggerRef: triggerRef, label: label, isOpen: showContent, useTrapFocusWithTrigger: useTrapFocusWithTrigger, onHidePanel: onHidePanelAction, onTransitionEnd: handleTransitionEnd, children: (0, jsx_runtime_1.jsxs)("div", { className: (0, classNames_1.classNames)(["zen-mobile-sheet", className]), ref: ref, children: [(0, jsx_runtime_1.jsxs)("div", { className: (0, classNames_1.classNames)(["zen-mobile-sheet__title", driveTitleClassName || ""]), children: [isBackVisible ?
                                    (0, jsx_runtime_1.jsx)(textIconButton_1.TextIconButton, { onClick: (e) => {
                                            e.stopPropagation();
                                            onBackClick === null || onBackClick === void 0 ? void 0 : onBackClick();
                                        }, "aria-label": backButtonAriaLabel || ((_b = (_a = title[0]) === null || _a === void 0 ? void 0 : _a.props) === null || _b === void 0 ? void 0 : _b.children) || translate("Back"), type: buttonType_1.ButtonType.TertiaryBlack, className: "zen-mobile-sheet__back-button", iconPosition: textIconButton_1.ButtonIconPosition.Start, icon: iconBackArrow_1.IconBackArrow, contentClasses: "ellipsis", children: title[0] }) : (0, jsx_runtime_1.jsx)("span", { className: "zen-mobile-sheet__title-text", children: title[0] }), (0, jsx_runtime_1.jsx)(textIconButton_1.TextIconButton, { onClick: onCloseClick, "aria-label": translate("Close"), iconSize: isDrive ? "huge" : "large", type: buttonType_1.ButtonType.TertiaryBlack, iconPosition: textIconButton_1.ButtonIconPosition.Start, className: "zen-mobile-sheet__close-button", icon: iconClose_1.IconClose })] }), (0, jsx_runtime_1.jsx)("div", { className: "zen-mobile-sheet__content", children: content[0] }), (0, jsx_runtime_1.jsx)("div", { className: (0, classNames_1.classNames)(["zen-mobile-sheet__footer", driveFooterClassName || ""]), children: footer[0] })] }) })] });
};
exports.MobileSheet = MobileSheet;
exports.TRANSLATIONS = [
    "Close"
];
exports.MobileSheet.Footer = mobileSheetFooter_1.MobileSheetFooter;
exports.MobileSheet.Content = mobileSheetContent_1.MobileSheetContent;
exports.MobileSheet.Title = mobileSheetTitle_1.MobileSheetTitle;
