"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TRANSLATIONS = exports.SortControl = exports.SortDirections = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const checkboxState_1 = require("../checkbox/checkboxState");
const popup_1 = require("../popup/popup");
const selectList_1 = require("../selectList/selectList");
const classNames_1 = require("../commonHelpers/classNames/classNames");
const useLanguage_1 = require("../utils/localization/useLanguage");
const useDriveClassName_1 = require("../utils/theme/useDriveClassName");
const useDrive_1 = require("../utils/theme/useDrive");
const iconChevronDownSmall_1 = require("../icons/iconChevronDownSmall");
const iconFilter3Asc_1 = require("../icons/iconFilter3Asc");
const iconFilter3Desc_1 = require("../icons/iconFilter3Desc");
const MENU_POSITION = "bottom-left";
const BUTTON_TEXT_DEFAULT = "Sort by";
var SortDirections;
(function (SortDirections) {
    SortDirections["Ascending"] = "asc";
    SortDirections["Descending"] = "desc";
})(SortDirections || (exports.SortDirections = SortDirections = {}));
const SortControl = ({ buttonText = BUTTON_TEXT_DEFAULT, id = "", sortBy, onChange, sortDirection = SortDirections.Ascending, directionIcon = true, disabled = false, className = "", items }) => {
    //allows for the resetting of the popup once a new option has been selected by assigning a random number as a key, changing it when an option is changed
    const [popupKey, setPopupKey] = (0, react_1.useState)(Math.random() * (999999999 - 0) + 0);
    const [isOpen, setIsOpen] = (0, react_1.useState)(false);
    const { translate } = (0, useLanguage_1.useLanguage)();
    const driveComponentClassName = (0, useDriveClassName_1.useDriveClassName)("zen-sort-container");
    const isDrive = (0, useDrive_1.useDrive)();
    const buttonTextValue = buttonText === BUTTON_TEXT_DEFAULT ? translate(BUTTON_TEXT_DEFAULT) : buttonText;
    const onOptionsToggle = (isCurrentlyOpen) => {
        setIsOpen(isCurrentlyOpen);
    };
    const onSortDirectionToggle = () => {
        if (sortDirection === SortDirections.Ascending) {
            onChange(SortDirections.Descending, sortBy);
        }
        else {
            onChange(SortDirections.Ascending, sortBy);
        }
    };
    const onOptionChange = (0, react_1.useCallback)((newItemState) => {
        [...newItemState].forEach(([k, v]) => {
            if (v === checkboxState_1.CheckboxState.On) {
                onChange(sortDirection === SortDirections.Ascending ? SortDirections.Ascending : SortDirections.Descending, k);
                setPopupKey(Math.random() * (999999999 - 0) + 0);
            }
        });
    }, [onChange, sortDirection]);
    const isSingleItem = items.length === 1;
    return (0, jsx_runtime_1.jsxs)("div", { id: id, className: (0, classNames_1.classNames)(["zen-sort-container", driveComponentClassName || "", className]), children: [(0, jsx_runtime_1.jsxs)("button", { type: "button", className: (0, classNames_1.classNames)(["zen-sort-container__button", isSingleItem ? "" : "zen-sort-container__button--left-item"]), onClick: () => onSortDirectionToggle(), disabled: disabled, title: translate("Change sort direction"), "aria-label": translate("Change sort direction"), children: [directionIcon
                        ? sortDirection === SortDirections.Ascending
                            ? (0, jsx_runtime_1.jsx)(iconFilter3Asc_1.IconFilter3Asc, { className: "zen-sort-container__sort-icon", size: isDrive ? "huge" : "large" })
                            : (0, jsx_runtime_1.jsx)(iconFilter3Desc_1.IconFilter3Desc, { className: "zen-sort-container__sort-icon", size: isDrive ? "huge" : "large" }) : (0, jsx_runtime_1.jsx)(jsx_runtime_1.Fragment, {}), (0, jsx_runtime_1.jsxs)("span", { className: "zen-sort-container__text-block", children: [buttonTextValue && (0, jsx_runtime_1.jsxs)("span", { children: [buttonTextValue, ": "] }), (0, jsx_runtime_1.jsx)("span", { children: (items.find((item) => item.id === sortBy) || items[0]).children })] })] }), isSingleItem
                ? ""
                : (0, jsx_runtime_1.jsx)(popup_1.Popup, { trigger: ((0, jsx_runtime_1.jsx)("button", { type: "button", className: "zen-sort-container__button zen-sort-container__button--small zen-sort-container__button--right-item", disabled: disabled, title: translate("Sort by"), children: (0, jsx_runtime_1.jsx)(iconChevronDownSmall_1.IconChevronDownSmall, { className: isOpen ? "zen-sort-container__arrow-icon--up" : "zen-sort-container__arrow-icon--down", size: isDrive ? "huge" : "large" }) })), alignment: MENU_POSITION, onOpenChange: (isCurrentlyOpen) => onOptionsToggle(isCurrentlyOpen), children: (0, jsx_runtime_1.jsx)(selectList_1.SelectList, { id: "sortControlSelectList", title: translate("Sort Options"), onChange: (itemMap) => onOptionChange(itemMap), items: [...items.reduce((acc, obj) => acc.set(obj.id, Object.assign(Object.assign({}, obj), { state: obj.id === sortBy ? checkboxState_1.CheckboxState.On : checkboxState_1.CheckboxState.Off })), new Map()).values()] }) }, popupKey)] });
};
exports.SortControl = SortControl;
exports.TRANSLATIONS = [
    "Sort by",
    "Sort Options",
    "Change sort direction"
];
