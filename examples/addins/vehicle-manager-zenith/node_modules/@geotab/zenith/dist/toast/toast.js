"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Toast = void 0;
const react_1 = require("react");
const feedbackContext_1 = require("../feedbackContainer/feedbackContext");
const useWarning_1 = require("../feedbackProvider/hooks/useWarning");
const Toast = ({ isOpen, header, type, onClose, hasIcon, action, id }) => {
    const { addToast, removeToast, toasts, toastsAnimation, toastsQueue, removedToastId, apiToastActions, setApiToastActions, mode } = (0, react_1.useContext)(feedbackContext_1.FeedbackContext);
    const generatedId = (0, react_1.useId)();
    const localId = id || generatedId;
    const isInQueue = toastsQueue.some((toast) => toast.id === localId);
    const isRendered = toasts.some((toast) => toast.id === localId);
    const isAnimating = toastsAnimation.some((toast) => toast.id === localId);
    const isApi = mode === "api";
    const toastIndex = toasts.findIndex((alert) => alert.id === localId);
    const isInApiToasts = !!apiToastActions.find((toast) => toast.id === localId);
    (0, useWarning_1.useWarning)({ mode, name: "toasts" });
    (0, react_1.useEffect)(() => {
        if (isApi) {
            if (isOpen && !isInApiToasts) {
                addToast({ header, id: localId, type, onClose: () => {
                        onClose();
                    }, hasIcon, action });
                return;
            }
            if (!isOpen && isInApiToasts) {
                removeToast(localId);
                onClose();
                return;
            }
            return;
        }
        if (isOpen && isInQueue && isRendered) {
            return;
        }
        if (isOpen && (!isInQueue && !isRendered)) {
            addToast({ header, id: localId, type, onClose: () => {
                    onClose();
                }, hasIcon, action });
        }
        if (!isOpen && isRendered && !isInQueue && !isAnimating) {
            if (toastIndex !== -1) {
                removedToastId.current = toastIndex;
            }
            removeToast(localId);
            onClose();
        }
    }, [
        localId,
        isOpen,
        header,
        type,
        addToast,
        onClose,
        removeToast,
        isInQueue,
        isRendered,
        isAnimating,
        toastIndex,
        removedToastId,
        hasIcon,
        action,
        isApi,
        apiToastActions,
        setApiToastActions,
        isInApiToasts
    ]);
    return null;
};
exports.Toast = Toast;
