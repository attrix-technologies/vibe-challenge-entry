"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useToast = void 0;
const react_1 = require("react");
const react_2 = require("react");
const feedbackContext_1 = require("../../feedbackContainer/feedbackContext");
const toast_1 = require("../toast");
const useToastState_1 = require("./useToastState");
const generateId_1 = require("../../commonHelpers/generateId");
const hideToastCallback_1 = require("../utils/hideToastCallback");
const useWarning_1 = require("../../feedbackProvider/hooks/useWarning");
const useToast = () => {
    const { removeToast, mode, setApiToastActions } = (0, react_2.useContext)(feedbackContext_1.FeedbackContext);
    const { toasts, setToasts, targetEvent } = (0, useToastState_1.useToastState)();
    const isAPIMode = mode === "api";
    const hideToast = (0, react_2.useCallback)(function (id) {
        setToasts((prevToasts) => [...prevToasts.filter((el) => el.id !== id)]);
        removeToast(id);
        if (isAPIMode) {
            setApiToastActions((prev) => [...prev.filter((el) => el.id !== id)]);
        }
    }, [isAPIMode, removeToast, setApiToastActions, setToasts]);
    const showToast = (0, react_2.useCallback)((newItem) => {
        const generatedId = (0, generateId_1.generateId)();
        const alertItem = Object.assign(Object.assign({}, newItem), { id: generatedId });
        setToasts((prev) => [...prev, alertItem]);
        return {
            id: generatedId,
            hideToast: () => {
                targetEvent.current.dispatchEvent(new CustomEvent("hideToast", { detail: { id: generatedId } }));
            }
        };
    }, [setToasts, targetEvent]);
    (0, useWarning_1.useWarning)({ mode, name: "toasts" });
    (0, react_2.useEffect)(() => {
        const callback = (event) => (0, hideToastCallback_1.hideToastCallback)(event, hideToast);
        targetEvent.current.addEventListener("hideToast", callback);
        // eslint-disable-next-line react-hooks/exhaustive-deps
        return () => targetEvent.current.removeEventListener("hideToast", callback);
    }, [hideToast, isAPIMode, targetEvent]);
    const shownToasts = (0, react_2.useMemo)(() => toasts.map((item) => (0, react_1.createElement)(toast_1.Toast, Object.assign({}, item, { onClose: () => hideToast(item.id), key: item.id, isOpen: true }))), [toasts, hideToast]);
    return {
        showToast,
        toasts: shownToasts
    };
};
exports.useToast = useToast;
