"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.FeedbackContainer = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = __importStar(require("react"));
const feedbackContext_1 = require("./feedbackContext");
const alertRaw_1 = require("../alertRaw/alertRaw");
const react_dom_1 = require("react-dom");
const useMobile_1 = require("../commonHelpers/hooks/useMobile");
const toastRaw_1 = require("../toastRaw/toastRaw");
const classNames_1 = require("../commonHelpers/classNames/classNames");
const getAlertAnimation_1 = require("./utils/getAlertAnimation");
const getToastAnimation_1 = require("./utils/getToastAnimation");
const FeedbackContainer = () => {
    const { alerts, removeAlert, toasts, removeToast, activeFeedback, removedAlertId, removedToastId, mode } = react_1.default.useContext(feedbackContext_1.FeedbackContext);
    const prevAlertsLength = react_1.default.useRef(alerts.length);
    const prevToastsLength = react_1.default.useRef(toasts.length);
    const isAPIMode = mode === "api";
    const isMobile = (0, useMobile_1.useMobile)();
    const isAlertAdded = alerts.length > prevAlertsLength.current;
    const isToastAdded = toasts.length > prevToastsLength.current;
    const sameAlertsLength = alerts.length === prevAlertsLength.current;
    const sameToastsLength = toasts.length === prevToastsLength.current;
    if (isAlertAdded) {
        removedAlertId.current = null;
    }
    if (isToastAdded) {
        removedToastId.current = null;
    }
    prevAlertsLength.current = alerts.length;
    prevToastsLength.current = toasts.length;
    const alertsToRender = (0, react_1.useMemo)(() => alerts.map((alert, indx) => (0, jsx_runtime_1.jsx)(alertRaw_1.AlertRaw, { id: alert.id, header: alert.header, text: alert.text, isOpen: true, onClose: () => {
            removeAlert(alert.id);
            removedAlertId.current = indx;
            alert.onClose();
        }, type: alert.type, animation: alert.animation || (sameAlertsLength ? null : (0, getAlertAnimation_1.getAlertAnimation)(isAlertAdded, indx, removedAlertId.current, isMobile, activeFeedback)), buttons: alert.buttons }, alert.id)), [alerts, isMobile, isAlertAdded, removeAlert, activeFeedback, sameAlertsLength, removedAlertId]);
    const alertClasses = (0, react_1.useMemo)(() => (0, classNames_1.classNames)(["zen-alerts", isMobile ? "zen-alerts--mobile" : ""]), [isMobile]);
    const toastClasses = (0, react_1.useMemo)(() => (0, classNames_1.classNames)(["zen-toasts", isMobile ? "zen-toasts--mobile" : ""]), [isMobile]);
    const alertsPortal = (0, react_1.useMemo)(() => (0, react_dom_1.createPortal)((0, jsx_runtime_1.jsx)("div", { className: alertClasses, children: alertsToRender }), document.body), [alertsToRender, alertClasses]);
    const toastsToRender = (0, react_1.useMemo)(() => toasts.map((toast, indx, arr) => (0, jsx_runtime_1.jsx)(toastRaw_1.ToastRaw, { id: toast.id, animation: toast.animation || (sameToastsLength ? null : (0, getToastAnimation_1.getToastAnimation)(isToastAdded, indx, removedToastId.current, arr.length, isMobile, activeFeedback)), header: toast.header, showSeconds: toast.showSeconds, isOpen: true, onClose: () => {
            removeToast(toast.id);
            removedToastId.current = indx;
            toast.onClose();
        }, type: toast.type, hasIcon: toast.hasIcon, action: toast.action }, toast.id)), [toasts, sameToastsLength, isToastAdded, removedToastId, isMobile, activeFeedback, removeToast]);
    const toastsPortal = (0, react_1.useMemo)(() => (0, react_dom_1.createPortal)((0, jsx_runtime_1.jsx)("div", { className: toastClasses, children: toastsToRender }), document.body), [toastsToRender, toastClasses]);
    return (0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [!isAPIMode && alertsPortal, !isAPIMode && toastsPortal] });
};
exports.FeedbackContainer = FeedbackContainer;
