"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.LazyContent = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const skeleton_1 = require("./skeleton");
// eslint-disable-next-line @typescript-eslint/naming-convention
const LazyContent = ({ content, width, height, type, render, errorHandler, error, cache = true, isVisible = true }) => {
    const [isLoading, setIsLoading] = (0, react_1.useState)(false);
    const [value, setValue] = (0, react_1.useState)();
    const [cachedValue, setCachedValue] = (0, react_1.useState)();
    (0, react_1.useEffect)(() => {
        if (!isVisible) {
            return;
        }
        if (content instanceof Function) {
            setIsLoading(true);
            const promise = cache && cachedValue ?
                Promise.resolve(cachedValue) :
                content();
            promise
                .then((result) => {
                setValue(result);
                if (cache) {
                    setCachedValue(result);
                }
            })
                .catch((e) => {
                const errorValue = errorHandler && errorHandler(e);
                errorValue && setValue(errorValue);
            })
                .finally(() => {
                setIsLoading(false);
            });
            return;
        }
        if (content && typeof content === "object" && "isLoading" in content && "data" in content) {
            if (error) {
                const errorValue = errorHandler(error);
                errorValue && setValue(errorValue);
                setIsLoading(false);
                return;
            }
            setIsLoading(content.isLoading);
            setValue(content.data);
            return;
        }
        setValue(content);
        setIsLoading(false);
    }, [content, errorHandler, error, cache, cachedValue, isVisible]);
    if (!isVisible) {
        return null;
    }
    return (0, jsx_runtime_1.jsx)(jsx_runtime_1.Fragment, { children: isLoading ? ((0, jsx_runtime_1.jsx)(skeleton_1.Skeleton, { type: type, width: width, height: height })) : ((value && render) ? render(value) : value) });
};
exports.LazyContent = LazyContent;
