"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Menu = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const controlledMenu_1 = require("./controlledMenu");
const menuItem_1 = require("./components/menuItem");
const menuSeparator_1 = require("./components/menuSeparator");
const classNames_1 = require("../commonHelpers/classNames/classNames");
// eslint-disable-next-line @typescript-eslint/naming-convention
const Menu = 
// eslint-disable-next-line react/prop-types
({ children, title, trigger, triggerRef, ariaLabel, ariaLabelledBy, alignment = "bottom-left", className }) => {
    const [isOpen, setIsOpen] = (0, react_1.useState)(false);
    const innerRef = (0, react_1.useRef)(null);
    const shouldRenderTrigger = !!trigger;
    const ref = (shouldRenderTrigger || !triggerRef) ? innerRef : triggerRef;
    const abortEventsControllerRef = (0, react_1.useRef)(null);
    const renderTrigger = () => (0, react_1.cloneElement)(trigger, {
        ref,
        onClick: () => {
            setIsOpen(!isOpen);
        }
    });
    (0, react_1.useEffect)(() => {
        var _a;
        if ((triggerRef === null || triggerRef === void 0 ? void 0 : triggerRef.current) && !shouldRenderTrigger) {
            (_a = abortEventsControllerRef.current) === null || _a === void 0 ? void 0 : _a.abort();
            abortEventsControllerRef.current = new AbortController();
            triggerRef.current.addEventListener("click", () => setIsOpen(!isOpen), { signal: abortEventsControllerRef.current.signal });
        }
    }, [triggerRef, isOpen, shouldRenderTrigger]);
    const triggerComp = shouldRenderTrigger ? renderTrigger() : null;
    return (0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [triggerComp, (0, jsx_runtime_1.jsx)(controlledMenu_1.ControlledMenu, { alignment: alignment, ariaLabel: ariaLabel, ariaLabelledby: ariaLabelledBy || (triggerComp === null || triggerComp === void 0 ? void 0 : triggerComp.props.id), isOpen: isOpen, setIsOpen: setIsOpen, triggerRef: ref, title: title, className: (0, classNames_1.classNames)(["zen-menu", className || ""]), children: children })] });
};
exports.Menu = Menu;
exports.Menu.Item = menuItem_1.MenuItem;
exports.Menu.Separator = menuSeparator_1.MenuSeparator;
