"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ReportPopup = exports.WEB_ITEM_ID = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
/* eslint-disable @typescript-eslint/no-floating-promises */
const react_1 = require("react");
const filterButton_1 = require("../filterButton/filterButton");
const popup_1 = require("../popup/popup");
const classNames_1 = require("../commonHelpers/classNames/classNames");
const reportPopupContent_1 = require("./reportPopupContent");
const waiting_1 = require("../waiting/waiting");
const focusableSelector_1 = require("../utils/focusableSelector");
exports.WEB_ITEM_ID = "web";
/**
 * @deprecated - will be removed in next major release
  */
const ReportPopup = ({ className, loader, onReportClick = () => { }, onViewInBrowserClick = () => { }, onPreparePDFClick = () => { } }) => {
    const [reports, setReports] = (0, react_1.useState)([]);
    const [isDataLoading, setIsDataLoading] = (0, react_1.useState)(false);
    const [isOpen, setIsOpen] = (0, react_1.useState)(false);
    const [isGrouped, setIsGrouped] = (0, react_1.useState)(false);
    const ref = (0, react_1.useRef)(null);
    const triggerId = (0, react_1.useId)();
    const onOpenChange = (0, react_1.useCallback)((v) => setIsOpen(v), [setIsOpen]);
    (0, react_1.useEffect)(() => {
        const isGroupedData = (dataItem) => "templates" in dataItem;
        if (isOpen) {
            setIsDataLoading(true);
            setIsGrouped(false);
            loader().then((data) => {
                if (isGroupedData(data.filter(item => item.id !== exports.WEB_ITEM_ID)[0])) {
                    setIsGrouped(true);
                }
                else {
                    setIsGrouped(false);
                }
                setReports([...data]);
            }).finally(() => {
                var _a, _b;
                setIsDataLoading(false);
                (_b = (_a = ref.current) === null || _a === void 0 ? void 0 : _a.querySelector(focusableSelector_1.FOCUSABLE_SELECTOR)) === null || _b === void 0 ? void 0 : _b.focus();
            });
        }
        else {
            setReports([]);
        }
    }, [isOpen, loader]);
    (0, react_1.useEffect)(() => {
        var _a, _b;
        !isDataLoading && ((_b = (_a = ref.current) === null || _a === void 0 ? void 0 : _a.querySelector(focusableSelector_1.FOCUSABLE_SELECTOR)) === null || _b === void 0 ? void 0 : _b.focus());
    }, [isDataLoading]);
    return (0, jsx_runtime_1.jsx)(popup_1.Popup, { className: (0, classNames_1.classNames)(["zen-report-popup", className || ""]), onOpenChange: onOpenChange, trigger: (0, jsx_runtime_1.jsx)(filterButton_1.FilterButton, { id: triggerId, isActive: isOpen, children: "Report" }), children: isOpen && (isDataLoading ?
            (0, jsx_runtime_1.jsx)(waiting_1.Waiting, { hideOverlay: true, delay: 0, isLoading: isDataLoading }) :
            (0, jsx_runtime_1.jsx)(reportPopupContent_1.ReportPopupContent, { ref: ref, onPreparePDFClick: (id) => { onPreparePDFClick(id); setIsOpen(false); }, onReportClick: (id) => { onReportClick(id); setIsOpen(false); }, onViewInBrowserClick: (id) => { onViewInBrowserClick(id); setIsOpen(false); }, isGrouped: isGrouped, reports: reports })) });
};
exports.ReportPopup = ReportPopup;
