"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NavHeader = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const classNames_1 = require("../../commonHelpers/classNames/classNames");
const react_1 = require("react");
const iconPlus_1 = require("../../icons/iconPlus");
const textIconButton_1 = require("../../textIconButton/textIconButton");
const controlledMenu_1 = require("../../menu/controlledMenu");
const iconClose_1 = require("../../icons/iconClose");
const useMobile_1 = require("../../commonHelpers/hooks/useMobile");
const nav_context_1 = require("../context/nav.context");
const navUtils_1 = require("../utils/navUtils");
const navHeaderSearch_1 = require("./navHeaderSearch/navHeaderSearch");
const navItem_1 = require("../navItem/navItem");
const NavHeaderComponent = ({ className, logo, logoLink, imgTitle, collapsedLogo, children }) => {
    const { collapsed, searchOpen } = (0, nav_context_1.useNavContext)();
    const isLogoImageString = (0, react_1.useMemo)(() => (0, navUtils_1.isImageUrl)(logo), [logo]);
    const isCollapsedLogoImageString = (0, react_1.useMemo)(() => (0, navUtils_1.isImageUrl)(collapsedLogo), [collapsedLogo]);
    const logoElement = isLogoImageString ? (0, jsx_runtime_1.jsx)("img", { className: "zen-nav-header__logo-image", src: logo, alt: imgTitle }) : logo;
    const logoCollapsedElement = isCollapsedLogoImageString ? (0, jsx_runtime_1.jsx)("img", { className: "zen-nav-header__logo-image", src: collapsedLogo, alt: imgTitle }) : collapsedLogo;
    const logoImage = collapsed && collapsedLogo ? logoCollapsedElement : logoElement;
    const logoToRender = logoImage && logoLink ? (0, jsx_runtime_1.jsx)("a", { href: logoLink, className: "zen-nav-header__logo-link", children: logoImage }) : logoImage;
    const navChildren = react_1.Children.toArray(children).map(actions => {
        const childrenActions = actions.props.children;
        const validChildren = react_1.Children.toArray(childrenActions)
            .filter(child => {
            const element = child;
            return element.type && element.type.displayName === "NavItem";
        })
            .map(child => (0, react_1.cloneElement)(child, {
            className: (0, classNames_1.classNames)([
                "zen-nav-item--level-2",
                child.props.className || ""
            ]),
            collapsed: false
        }));
        return (0, react_1.cloneElement)(actions, Object.assign(Object.assign({}, actions.props), { children: validChildren }));
    });
    return (0, jsx_runtime_1.jsxs)("div", { className: (0, classNames_1.classNames)(["zen-nav-header", collapsed ? "zen-nav-header--collapsed" : "", searchOpen ? "zen-nav-header--mode-search" : "", className || ""]), children: [searchOpen ? null : logoToRender, (0, jsx_runtime_1.jsx)("div", { className: "zen-nav-header__controls", children: navChildren })] });
};
const NavHeaderAction = navItem_1.NavItem;
const NavHeaderActions = ({ title, className, children }) => {
    const [isOpen, setIsOpen] = (0, react_1.useState)(false);
    const isMobile = (0, useMobile_1.useMobile)();
    const triggerRef = (0, react_1.useRef)(null);
    return (0, jsx_runtime_1.jsx)(navItem_1.NavItemContext.Provider, { value: { parentLevel: 2 }, children: (0, jsx_runtime_1.jsxs)("div", { className: (0, classNames_1.classNames)(["zen-nav-header__actions", className || ""]), children: [(0, jsx_runtime_1.jsx)(textIconButton_1.TextIconButton, { type: "primary", title: title, className: "zen-nav-header__actions-icon", icon: isOpen && !isMobile ? iconClose_1.IconClose : iconPlus_1.IconPlus, iconSize: "large", ref: triggerRef, onClick: () => setIsOpen(!isOpen) }), (0, jsx_runtime_1.jsx)(controlledMenu_1.ControlledMenu, { title: title, isOpen: isOpen, setIsOpen: setIsOpen, triggerRef: triggerRef, alignment: "right-top", paddingX: 8, paddingY: 8, className: (0, classNames_1.classNames)(["zen-nav-l2-popup  zen-nav-l2-popup--narrow", isMobile ? "zen-nav-l2-popup--mobile" : ""]), listClassName: (0, classNames_1.classNames)(["zen-nav-l2-popup__list", isMobile ? "zen-nav-l2-popup__list--mobile" : ""]), children: children })] }) });
};
/**
 * @beta This component is not fully ready yet and may change in future releases.
 */
exports.NavHeader = Object.assign(NavHeaderComponent, { Actions: NavHeaderActions, Action: NavHeaderAction, Search: navHeaderSearch_1.NavHeaderSearch });
exports.NavHeader.displayName = "NavHeader";
