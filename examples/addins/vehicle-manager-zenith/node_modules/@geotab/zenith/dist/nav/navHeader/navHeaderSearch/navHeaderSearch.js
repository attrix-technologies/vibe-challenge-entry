"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NavHeaderSearch = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const useMobile_1 = require("../../../commonHelpers/hooks/useMobile");
const nav_context_1 = require("../../context/nav.context");
const useLanguage_1 = require("../../../utils/localization/useLanguage");
const useDebounce_1 = require("../../../commonHelpers/hooks/useDebounce");
const classNames_1 = require("../../../commonHelpers/classNames/classNames");
const textIconButton_1 = require("../../../textIconButton/textIconButton");
const iconSearch_1 = require("../../../icons/iconSearch");
const searchInput_1 = require("../../../searchInput/searchInput");
const NavHeaderSearch = ({ className, onSearch }) => {
    const isMobile = (0, useMobile_1.useMobile)();
    const { searchOpen, onSearchToggle, searchTerm = "", onSearch: contextOnSearch } = (0, nav_context_1.useNavContext)();
    const { translate } = (0, useLanguage_1.useLanguage)();
    const onSearchCallback = (0, react_1.useCallback)((term) => {
        onSearch === null || onSearch === void 0 ? void 0 : onSearch(term);
    }, [onSearch]);
    const debouncedSearch = (0, useDebounce_1.useDebounce)(onSearchCallback);
    const handleChange = (0, react_1.useCallback)((term) => {
        contextOnSearch === null || contextOnSearch === void 0 ? void 0 : contextOnSearch(term);
        debouncedSearch(term);
    }, [debouncedSearch, contextOnSearch]);
    const handleBlur = (0, react_1.useCallback)(() => {
        // On desktop, close search if term is empty
        if (!isMobile && !searchTerm.trim()) {
            onSearchToggle === null || onSearchToggle === void 0 ? void 0 : onSearchToggle(false);
        }
    }, [isMobile, searchTerm, onSearchToggle]);
    const handleKeyDown = (0, react_1.useCallback)((event) => {
        if (event.key === "Escape") {
            handleChange("");
            onSearchToggle === null || onSearchToggle === void 0 ? void 0 : onSearchToggle(false);
        }
    }, [handleChange, onSearchToggle]);
    return (0, jsx_runtime_1.jsxs)("div", { className: (0, classNames_1.classNames)(["zen-nav-header-search", className || ""]), children: [!searchOpen && !isMobile ? (0, jsx_runtime_1.jsx)(textIconButton_1.TextIconButton, { className: "zen-nav-header-search__button", icon: iconSearch_1.IconSearch, onClick: () => onSearchToggle === null || onSearchToggle === void 0 ? void 0 : onSearchToggle(true), title: translate("Search") }) : null, searchOpen || isMobile ? (0, jsx_runtime_1.jsx)(searchInput_1.SearchInput, { autoFocus: true, ariaLabel: translate("Search"), value: searchTerm, placeholder: translate("Search"), className: "zen-nav-header-search__input", onChange: handleChange, onBlur: handleBlur, onKeyDown: handleKeyDown }) : null] });
};
exports.NavHeaderSearch = NavHeaderSearch;
