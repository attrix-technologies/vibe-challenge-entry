"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NavSection = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const classNames_1 = require("../../commonHelpers/classNames/classNames");
const react_1 = require("react");
const nav_context_1 = require("../context/nav.context");
const navItem_1 = require("../navItem/navItem");
/**
 * @beta This component is not fully ready yet and may change in future releases.
 */
const NavSection = ({ children, className }) => {
    const { collapsed } = (0, nav_context_1.useNavContext)();
    const focusedIndex = (0, react_1.useRef)(0);
    const childRefs = (0, react_1.useRef)([]);
    const sectionRef = (0, react_1.useRef)(null);
    const focusableChildren = (0, react_1.useMemo)(() => react_1.Children.map(children, (child, i) => {
        if ((0, react_1.isValidElement)(child) && child.type === navItem_1.NavItem) {
            return (0, react_1.cloneElement)(child, {
                tabIndex: i === 0 ? 0 : -1
            });
        }
        return child;
    }), [children]);
    (0, react_1.useEffect)(() => {
        if (!sectionRef.current) {
            return;
        }
        const navItemElements = sectionRef.current.querySelectorAll(".zen-nav-item");
        childRefs.current = Array.from(navItemElements);
    }, [children]);
    const arrowClickHandler = (0, react_1.useCallback)((evt) => {
        var _a, _b, _c;
        const key = evt.key;
        if ((key !== "ArrowDown" && key !== "ArrowUp" &&
            key !== "Home" && key !== "End" &&
            key !== "PageUp" && key !== "PageDown") || // non-handled keys
            !children || // section is empty
            !evt.target.closest(".zen-nav-section") // event triggered outside of section
        ) {
            return;
        }
        evt.preventDefault();
        (_a = childRefs.current[focusedIndex.current]) === null || _a === void 0 ? void 0 : _a.setAttribute("tabindex", "-1");
        if (key === "ArrowDown") {
            // get next in a loop
            focusedIndex.current = focusedIndex.current === react_1.Children.count(children) - 1 ? 0 : focusedIndex.current + 1;
        }
        if (key === "ArrowUp") {
            // get previous in a loop
            focusedIndex.current = focusedIndex.current === 0 ? react_1.Children.count(children) - 1 : focusedIndex.current - 1;
        }
        if (key === "Home" || key === "PageUp") {
            focusedIndex.current = 0;
        }
        if (key === "End" || key === "PageDown") {
            focusedIndex.current = react_1.Children.count(children) - 1;
        }
        (_b = childRefs.current[focusedIndex.current]) === null || _b === void 0 ? void 0 : _b.setAttribute("tabindex", "0");
        (_c = childRefs.current[focusedIndex.current]) === null || _c === void 0 ? void 0 : _c.focus();
    }, [children]);
    const cssClasses = (0, classNames_1.classNames)(["zen-nav-section", className || "", collapsed ? "zen-nav-section--collapsed" : ""]);
    return (0, jsx_runtime_1.jsx)("div", { ref: sectionRef, role: "menu", className: cssClasses, onKeyDown: arrowClickHandler, children: focusableChildren });
};
exports.NavSection = NavSection;
exports.NavSection.displayName = "NavSection";
