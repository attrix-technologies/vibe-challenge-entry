"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useStretch = void 0;
const react_1 = require("react");
const classNames_1 = require("../../commonHelpers/classNames/classNames");
const getGridRows_1 = require("../utils/getGridRows");
const useTablet_1 = require("./useTablet");
const useMobile_1 = require("../../commonHelpers/hooks/useMobile");
const useStretch = (stretch, childrenArr, ref, setChildrenArrState) => {
    const [elHeight, setElHeight] = (0, react_1.useState)([]);
    const isTablet = (0, useTablet_1.useTablet)();
    const isMobile = (0, useMobile_1.useMobile)();
    (0, react_1.useLayoutEffect)(() => {
        var _a;
        if (!stretch) {
            setChildrenArrState(childrenArr);
            return;
        }
        const childNodes = [...(((_a = ref.current) === null || _a === void 0 ? void 0 : _a.children) || [])];
        const clientHeightArr = childNodes.map(child => child.clientHeight);
        setElHeight(clientHeightArr);
    }, [childrenArr, ref, setChildrenArrState, stretch]);
    const calculate = (0, react_1.useCallback)(() => {
        var _a;
        if (!stretch) {
            setChildrenArrState(childrenArr);
            return;
        }
        const childNodes = [...(((_a = ref.current) === null || _a === void 0 ? void 0 : _a.children) || [])];
        const rows = (0, getGridRows_1.getGridRows)(childNodes.map(child => child.getBoundingClientRect().y), elHeight);
        const newArr = childrenArr.map((child, indx) => {
            const row = rows.find(r => r.findIndex(i => i.index === indx) !== -1);
            if ((row === null || row === void 0 ? void 0 : row.length) === 1 || !row) {
                return child;
            }
            const maxIndexInRow = row.reduce((acc, curr, _, arr) => {
                const maxItem = arr.find(el => el.index === acc);
                if (maxItem && curr.height > maxItem.height) {
                    return curr.index;
                }
                return acc;
            }, row[0].index);
            if (indx === maxIndexInRow) {
                return child;
            }
            const clone = (0, react_1.cloneElement)(child, {
                className: (0, classNames_1.classNames)([
                    (child.props.className || ""),
                    "zen-col-stretch"
                ]),
                key: child.props.id || child.key || indx
            });
            return clone;
        });
        setChildrenArrState(newArr);
    }, [childrenArr, elHeight, ref, setChildrenArrState, stretch]);
    (0, react_1.useEffect)(() => {
        calculate();
    }, [calculate, isTablet, isMobile]);
};
exports.useStretch = useStretch;
