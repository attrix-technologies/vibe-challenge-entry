"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.FiltersSaveModal = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const modal_1 = require("../../modal/modal");
const useLanguage_1 = require("../../utils/localization/useLanguage");
const textInput_1 = require("../../textInput/textInput");
const filtersSavedItemsProvider_1 = require("./filtersSavedItemsProvider");
const iconDisk_1 = require("../../icons/iconDisk");
const useDriveClassName_1 = require("../../utils/theme/useDriveClassName");
const FiltersSaveModal = ({ isOpen, onClose, onSave }) => {
    const { translate } = (0, useLanguage_1.useLanguage)();
    const { items } = (0, filtersSavedItemsProvider_1.useFiltersSavedItems)();
    const iconDriveClassName = (0, useDriveClassName_1.useDriveClassName)("icon");
    const [filterName, setFilterName] = (0, react_1.useState)("");
    const toggleSaveModal = (0, react_1.useCallback)(() => {
        onClose(!isOpen);
    }, [isOpen, onClose]);
    const handleCancelSaveModal = (0, react_1.useCallback)(() => {
        onClose(false);
        setFilterName("");
    }, [onClose]);
    const isValidFilterName = (0, react_1.useCallback)((name, existingNames) => {
        if (!name) {
            return false;
        }
        return !existingNames.map((item) => item.toLowerCase().trim()).includes(name.toLowerCase().trim());
    }, []);
    const handleApplySaveModal = (0, react_1.useCallback)(() => {
        if (!isValidFilterName(filterName, Array.from(items))) {
            return;
        }
        onClose(false);
        onSave(filterName);
        setFilterName("");
    }, [filterName, isValidFilterName, items, onClose, onSave]);
    const handleSaveModalFieldChange = (0, react_1.useCallback)((e) => {
        setFilterName(e.target.value);
    }, []);
    const errorText = (0, react_1.useMemo)(() => {
        if (!filterName) {
            return "";
        }
        if (!isValidFilterName(filterName, Array.from(items))) {
            return translate("Title already in use");
        }
        return "";
    }, [filterName, isValidFilterName, items, translate]);
    const saveIcon = (0, react_1.useCallback)(() => (0, jsx_runtime_1.jsx)(iconDisk_1.IconDisk, { description: translate("Save"), className: "svgIcon", size: iconDriveClassName ? "huge" : "large" }), [iconDriveClassName, translate]);
    return (0, jsx_runtime_1.jsxs)(modal_1.Modal, { isOpen: isOpen, onClose: toggleSaveModal, title: translate("Save filters"), children: [(0, jsx_runtime_1.jsx)("div", { className: "zen-filters-modal__content", children: (0, jsx_runtime_1.jsx)(textInput_1.TextInput, { value: filterName, ariaLabel: translate("Filter title"), placeholder: translate("Filter title"), onChange: handleSaveModalFieldChange, maxLength: 100, error: errorText }) }), (0, jsx_runtime_1.jsx)(modal_1.Modal.SecondaryButton, { onClick: handleCancelSaveModal, title: translate("Cancel"), children: translate("Cancel") }), (0, jsx_runtime_1.jsx)(modal_1.Modal.PrimaryButton, { onClick: handleApplySaveModal, icon: saveIcon, title: translate("Save"), children: translate("Save") })] });
};
exports.FiltersSaveModal = FiltersSaveModal;
