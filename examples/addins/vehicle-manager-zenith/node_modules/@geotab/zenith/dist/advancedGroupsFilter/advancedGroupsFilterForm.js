"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TRANSLATIONS = exports.AdvancedGroupsFilterForm = void 0;
const jsx_runtime_1 = require("react/jsx-runtime");
const textIconButton_1 = require("../textIconButton/textIconButton");
const advancedGroupsFilterFormSection_1 = require("./advancedGroupsFilterFormSection");
const groupsHelper_1 = require("../groupsFilter/groupsHelper");
const groupsFilterInterfaces_1 = require("../groupsFilter/groupsFilterInterfaces");
const iconPlus_1 = require("../icons/iconPlus");
const useLanguage_1 = require("../utils/localization/useLanguage");
const AdvancedGroupsFilterForm = ({ state, onStateChange, getData, errorHandler, dataItems, tooltipText }) => {
    const { translate } = (0, useLanguage_1.useLanguage)();
    const handleAddNewCondition = () => {
        onStateChange([...state, { sectionState: (0, groupsHelper_1.getDefaultFilterState)(), interSectionRelation: groupsFilterInterfaces_1.RelationOperator.OR }]);
    };
    const handleInterSectionRelationChange = (idx) => {
        const newState = [...state.slice(0, idx), Object.assign(Object.assign({}, state[idx]), { interSectionRelation: state[idx].interSectionRelation === groupsFilterInterfaces_1.RelationOperator.OR ? groupsFilterInterfaces_1.RelationOperator.AND : groupsFilterInterfaces_1.RelationOperator.OR }), ...state.slice(idx + 1, state.length)];
        onStateChange(newState);
    };
    const handleRelationChange = (ind) => {
        const newState = [...state.slice(0, ind), Object.assign(Object.assign({}, state[ind]), { sectionState: Object.assign(Object.assign({}, state[ind].sectionState), { relation: state[ind].sectionState.relation === groupsFilterInterfaces_1.RelationOperator.OR ? groupsFilterInterfaces_1.RelationOperator.AND : groupsFilterInterfaces_1.RelationOperator.OR }) }), ...state.slice(ind + 1, state.length)];
        onStateChange(newState);
    };
    const handleStateChange = (ind, value) => {
        const newState = [...state.slice(0, ind), Object.assign(Object.assign({}, state[ind]), { sectionState: Object.assign(Object.assign({}, state[ind].sectionState), { items: value.map(el => ({ id: el })) }) }), ...state.slice(ind + 1, state.length)];
        onStateChange(newState);
    };
    const handleRemoveCondition = (e) => {
        if (state.length === 1) {
            return;
        }
        const ind = e.target.dataset.item ? Number(e.target.dataset.item) : undefined;
        const newState = ind !== undefined ? [...state.slice(0, ind),
            ...state.slice(ind + 1, state.length)
        ] : state;
        onStateChange(newState);
    };
    return (0, jsx_runtime_1.jsxs)("div", { className: "zen-advanced-groups-filter-form", children: [(0, jsx_runtime_1.jsx)("div", { className: "zen-advanced-groups-filter-form__description", children: translate("Create conditions below to filter the entire system.") }), (0, jsx_runtime_1.jsx)("ul", { className: "zen-advanced-groups-filter-form__sections", children: state.map((el, ind) => (0, jsx_runtime_1.jsx)(advancedGroupsFilterFormSection_1.AdvancedGroupsFilterFormSection, { state: el.sectionState, itemId: ind, interSectionRelation: ind === 0 || state.length === 1 ? undefined : state[ind].interSectionRelation, onInterSectionChange: handleInterSectionRelationChange, onRelationChange: handleRelationChange, onRemoveCondition: handleRemoveCondition, onStateChange: handleStateChange, isHasRemoveConditionButton: state.length > 1, isHasTooltip: ind === 0, tooltipText: tooltipText, getData: getData, errorHandler: errorHandler, dataItems: dataItems }, `form-section_ind-${ind}_${state.length}`)) }), (0, jsx_runtime_1.jsx)("div", { className: "zen-form__add-section", children: (0, jsx_runtime_1.jsx)(textIconButton_1.TextIconButton, { className: "zen-advanced-groups-filter-form__add-button", onClick: handleAddNewCondition, iconPosition: textIconButton_1.ButtonIconPosition.Start, iconSize: "large", icon: iconPlus_1.IconPlus, children: translate("Add new condition") }) })] });
};
exports.AdvancedGroupsFilterForm = AdvancedGroupsFilterForm;
exports.TRANSLATIONS = [
    ...advancedGroupsFilterFormSection_1.TRANSLATIONS,
    "Create conditions below to filter the entire system.",
    "Add new condition"
];
